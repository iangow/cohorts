<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; Un intermezzo – Cohort analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./revised.html" rel="next">
<link href="./dbplyr.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./intermezzo.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Un intermezzo</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Cohort analysis</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./original_sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Cohorts - the original chapter</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ctes_comments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Cohorts using CTEs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dbplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Cohorts using <code>dbplyr</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intermezzo.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Un intermezzo</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./revised.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Cohorts: Revised</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#an-alternative-taxonomy" id="toc-an-alternative-taxonomy" class="nav-link active" data-scroll-target="#an-alternative-taxonomy"><span class="header-section-number">5.0.1</span> An alternative taxonomy?</a></li>
  <li><a href="#survival-data-the-basic-building-block" id="toc-survival-data-the-basic-building-block" class="nav-link" data-scroll-target="#survival-data-the-basic-building-block"><span class="header-section-number">5.1</span> Survival data: The basic building block</a>
  <ul class="collapse">
  <li><a href="#survival-once-only-events" id="toc-survival-once-only-events" class="nav-link" data-scroll-target="#survival-once-only-events"><span class="header-section-number">5.1.1</span> Survival: Once-only events</a></li>
  <li><a href="#survival-censoring" id="toc-survival-censoring" class="nav-link" data-scroll-target="#survival-censoring"><span class="header-section-number">5.1.2</span> Survival: Censoring</a></li>
  <li><a href="#sec-census-date" id="toc-sec-census-date" class="nav-link" data-scroll-target="#sec-census-date"><span class="header-section-number">5.1.3</span> Events that can happen more than once: The census-date approach</a></li>
  <li><a href="#sec-stints" id="toc-sec-stints" class="nav-link" data-scroll-target="#sec-stints"><span class="header-section-number">5.1.4</span> Events that can happen more than once: Stints</a></li>
  <li><a href="#why-use-census-dates" id="toc-why-use-census-dates" class="nav-link" data-scroll-target="#why-use-census-dates"><span class="header-section-number">5.1.5</span> Why use census dates?</a></li>
  </ul></li>
  <li><a href="#organizing-cohort-data" id="toc-organizing-cohort-data" class="nav-link" data-scroll-target="#organizing-cohort-data"><span class="header-section-number">5.2</span> Organizing cohort data</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Un intermezzo</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>I take a brief pause in this chapter to organize some bigger-picture thoughts about Chapter 4 of <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span> before launching into a to-be-written alternative version of that chapter in <a href="revised.html" class="quarto-xref"><span>Chapter 6</span></a>. This chapter is not intended to be particularly coherent, but it meant more as a dumping ground for some raw materials that might be used to create an alternative version of Chapter 4 of <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span>.</p>
<p>I think there is a lot to like about Chapter 4 of <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span>. First, I love the use of a real data set, as I think it gets readers and students thinking about the data more deeply than is possible with simulated [fake] data. Also real data are more apt to cough up interesting complexities that are not easily anticipated with fake data. Second, the focus on the steps needed to get the data ready for analysis distinguishes Chapter 4 of <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span>—indeed the whole book—both from books that focus on more elementary SQL (e.g., <code>CREATE TABLE</code>) and simpler data and from books that get hung up in statistical methods and neglect the all-important steps of preparing the data. Third, there is a richness to the examples. <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span> pushes the legislators data hard.</p>
<p>That said, there are some weaknesses. First, at 54 pages, the chapter is probably too long. While it’s notionally shorter than Chapter 3 of <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span>, Chapter 3 is really one chapter on data types (first 13 pages) and another chapter on the retail sales data set (47 pages). My sense is that it might make sense to drop a couple of queries and perhaps use a different data set for some aspects (e.g., the cumulative analysis feels a bit forced with the legislators data). Second, not every query is motivated by a precise question. As such, it can be hard to understand why various choices are being made. Third, I think this chapter nicely illustrates the outer limits of what you want to be doing with straight SQL with nested subqueries. I think one can do better using <code>dbplyr</code> to generate SQL. I believe that using <code>dbplyr</code> allows one to use more of a modular, building-block approach to some of the queries. For example, one can split apart the formation of cohorts from the arrangement of the basic survival data; I illustrate some ideas along these lines at the end of this chapter. I guess that this could lead to a shorter chapter. Fourth, <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span> does not discuss approaches to handling censored data. While censoring is something more often found in an advanced statistics book, I think it can be handled at a level that does not demand high levels of statistical sophistication <span class="citation" data-cites="singer2003longitudinal">(e.g., see Chapter 10 of <a href="references.html#ref-singer2003longitudinal" role="doc-biblioref">Singer and Willett 2003</a>)</span>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>Finally, I feel that the taxonomy provided in <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span> is not as helpful as it might be. Perhaps an alternative taxonomy would be better. So I start with a taxonomy of analyses using survival analysis as the basic platform.</p>
<section id="an-alternative-taxonomy" class="level3" data-number="5.0.1">
<h3 data-number="5.0.1" class="anchored" data-anchor-id="an-alternative-taxonomy"><span class="header-section-number">5.0.1</span> An alternative taxonomy?</h3>
<p>The situations for which <em>survival</em> analysis was named can be framed either in terms of the period of survival or in terms of the <strong>event</strong> which denotes the end of the survival period (e.g., death). While many sources <span class="citation" data-cites="singer2003longitudinal">(e.g., <a href="references.html#ref-singer2003longitudinal" role="doc-biblioref">Singer and Willett 2003, 306</a>)</span> focus on the event, one can equally well focus on the <strong>states</strong> (i.e., “alive” before the event and [euphemistically] “not alive” after the event).</p>
<p>With the terminology established, the first dichotomy is between <strong>once-only events</strong> and <strong>possibly repeated events</strong>. With <em>senso strictu</em> survivorship analysis where the “event” is death, the event only occurs once.</p>
<p>In other situations, the “once-only” nature of the event studied is a function of how it is defined by the analyst. <span class="citation" data-cites="singer2003longitudinal">Singer and Willett (<a href="references.html#ref-singer2003longitudinal" role="doc-biblioref">2003</a>)</span> provide examples such as time to relapse among recently treated alcoholic and age at first suicide ideation. While one could track alcoholics over an extended period that allows them the opportunity to relapse, re-enter treatment, and then perhaps relapse again, by defining relapse as the first such event after treatment, it can occur at most once. Because of the way these events have been defined, if the event hadn’t occurred by a date later than <span class="math inline">\(t\)</span>, then it hadn’t occurred by <span class="math inline">\(t\)</span>.</p>
<p>Often defining the event in such a way that it can happen at most once provides clear analytical benefits. Apart from simplifying data collation, a focus on once-only events allows an analyst to use one of the many statistical models adapted to such situations. For example, <span class="citation" data-cites="singer2003longitudinal">Singer and Willett (<a href="references.html#ref-singer2003longitudinal" role="doc-biblioref">2003</a>)</span> “focuses exclusively on the most common and fundamental problem: the analysis of single spells [i.e., once-only events]” [p.&nbsp;311]. <span class="citation" data-cites="singer2003longitudinal">Singer and Willett (<a href="references.html#ref-singer2003longitudinal" role="doc-biblioref">2003</a>)</span> provides tools for discrete-time and continuous-time analyses, including the Cox regression model and extensions to that model. While such models are beyond the scope of this book, they can be implemented once an analyst has organized the data into the canonical form for survival data. My focus below is on organizing data for such analysis.</p>
<p>A second dichotomy relates to whether the states are <strong>inherently continuous</strong> or involve <strong>repeated actions</strong>. Conventional understanding has it that a person begins life at (or near) the date of birth and is alive until the date of death. “Being alive” is a continuous state. In the context of Chapter 4 of <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span>, a legislator is elected to a term and remains a legislator until the term ends, either through expiration of the term, resignation, or death.</p>
<p>But in other situations, there may be no inherently continuous state. For example, suppose (very hypothetically) that I were a regular Starbucks customer. Almost every morning I stop by the local Starbucks for a muffin and my regular coffee. Sometimes I pick up an afternoon caramel macchiato and I might grab breakfast at the airport Starbucks when travelling. Almost never do I partake in the Seattle-based company’s wares on weekends.</p>
<p>In this scenario, I might reasonably be described as a “regular Starbucks customer” even in the evening or on weekends. The challenge for the data analyst is that, while there is no continuous state observed in the data as there is with congressional terms or human lifetimes, we might want to treat “regular Starbucks customer” as the state of interest and therefore need to define “regular Starbucks customer” in terms of actions (e.g., at least one purchase per month) or through related states (e.g., being a member of the Starbucks rewards program).</p>
<p>In some cases, there will be underlying states of interest that are continuous, but the data analyst might need to infer these states from discrete observations in the data.</p>
<p>My first thought is that the mapping from these two dichotomies to each the four types of cohort analysis identified by <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span> is not entirely clear. <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021, 124</a>)</span> suggests that retention analysis is particularly relevant when the activity engaged involves “repeated actions”, but it is not clear whether it is the first or the second dichotomy above that is relevant here. Depending on the revenue model, “playing an online game” might involve either discrete actions over time or maintaining a subscription.</p>
<p>In other places, the rationale for the taxonomy of <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span> is unclear. <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021, 124</a>)</span> suggests that retention analysis is “concerned with whether the cohort member has a record in the time series on a particular date, expressed as a number of periods from the starting date.” But it is not clear that this is the natural choice to make in all cases.</p>
<p>An illustration of the implications of this definition can be seen in <a href="#tbl-jqa" class="quarto-xref">Table&nbsp;<span>5.11</span></a> near the end of this chapter. There it can be seen that John Quincy Adams (“JQA”) would be considered to have been “retained” in periods 28 through 45 notwithstanding his absence during periods 6 through 27, including a stint as president from 1825–1829. If we think of this analysis as being one about customer retention, we might have incurred significant customer acquisition costs (e.g., trial periods or discounts) to get JQA onboard in period 0 and then incurred those same costs all over again to sign up JQA in period 28. For the purposes of customer retention analysis (e.g., evaluating the effectiveness of AOL-style CDs distributed in the mail … we are talking about the olden days, after all), we might want to either ignore periods after losing JQA as a customer, or treat these as a completely different stint (see below). While this does not make the retention analysis in <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span> necessarily <em>wrong</em>, it does suggest that the taxonomy is not exhaustive of the ways we might want to structure an analysis.</p>
<p><span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021, 124</a>)</span> suggests that what distinguishes survivorship analysis is that “instead of calculating whether an entity was present in a certain period [as in retention analyis], we calculate whether the entity is present in that period or later in the time series.” One rationale for this distinction is that, if we observe that an individual is in the “alive” state at both time <span class="math inline">\(0\)</span> and time <span class="math inline">\(2\)</span>, we can conclude that that individual was alive at time <span class="math inline">\(1\)</span>. In this sense, the distinction maybe about make inferences about continuous states from discrete events or actions. Unfortunately, the legislators data is not a good setting for making such inferences in general, as one can be a senator, then not a senator, then a senator again and—though we learn below that some “filling” may be needed—the data on terms of the legislators is provided to us in a way that allows us to deduce the continuous state (“being a legislator”) without needing to fill in gaps between discrete events.</p>
<p>It is also not clear that the survivorship-versus-retention dichotomy of <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span> has anything to do with whether the events are once-only events or not. For once-only events, being alive at time <span class="math inline">\(t\)</span> is implied by being alive at time <span class="math inline">\(t\)</span> “or later in the time series.” Elsewhere <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021, 127</a>)</span> suggests that often “a cohort can lose but cannot gain new members once it is formed.” So for many purposes the survivorship-versus-retention dichotomy only matters when the events are <em>not</em> once-only.</p>
<p>The other two categories of analysis in the <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021, 124</a>)</span> are returnship and cumulative. Returnship examines of repeated actions occurring “more than some minimum threshold of times … during a fixed window of time” and cumulative analyses “are concerned with the total number of times or amounts measured at one or more fixed time windows”. Returnship seems to involve counting over windows, while cumulative analysis likely requires summing of some measure over windows. Given that a count is simply a sum of ones that indicate an action, this suggests that returnship is often perhaps a species of cumulative analysis.</p>
<p>My hunch is that the latter two categories are not at the same level as the first two. One could do returnship and cumulative analysis in situations where there are once-only events or where multiple events are possible. Similarly, one could do returnship and cumulative analysis in situations whether the states are inherently continuous or involve repeated actions.</p>
<p>I argue that what distinguishes the latter two categories from the other analyses is the metric chosen. For survival, we are in effect integrating the function <span class="math inline">\(f(t) = 1\)</span> from the start of the window to the end. With cumulative analysis, the function we are integrating might be, say, <span class="math inline">\(f(t) = \text{Revenue}(t)\)</span> if we are looking to accumulate revenue and returnship we might be summing the count function over some time window. This view gets some support from <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021, 127</a>)</span>, where retention analysis is described as potentially including “the <code>count</code> of entities or <code>sum</code> of money or actions” [i.e., things discussed in the sections on returnship and cumulative analyses].</p>
<p>That said, my sense is that returnship and cumulative analysis can present novel challenges from a data analysis perspective. The legislators data set does appear to provide an interesting example for returnship in the form of the question: “What proportion of legislators who start as representatives go on to become senators?” But this is just a survival analysis with the “event” being “becoming senator” rather than “ceasing to be a legislator” and the population limited to “legislators who start as a representative” rather than including all legislators. In contrast, the “cumulative” example using legislators (average number of terms) feels a bit more contrived and likely quite different in terms of the structure of the code from what you would need to do “cumulative revenue per customer by cohort” or similar.</p>
<p>My hunch is that the most elemental analysis is one mirroring the original kind of survival analysis: once-only events with continuous states. Once this setting has been covered, one could cover issues involved in handling potentially repeated events and those arising when one observes discrete actions rather than events delineating boundaries between continuous states.</p>
<p>My other hunch is that the analysis is much easier to understand when it is motivated by a clear question, such as the one used in the section covering returnship as discussed above. It isn’t clear why the retention curve in Figure 4-4 of <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021, 135</a>)</span> includes legislators at time <span class="math inline">\(t\)</span> even if they have had a spell out of office prior to <span class="math inline">\(t\)</span> (“survivorship” analyses would seem to exclude these) and does not include legislators at time <span class="math inline">\(t\)</span> if they are out of office at that time, but will be in office at a later date (“retention” analyses would seem to include these). If the question that Figure 4-4 of <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021, 135</a>)</span> intends to answer were stated more clearly, then the choices to be made might also be clearer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(farr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>db <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>legislators_terms <span class="ot">&lt;-</span> <span class="fu">load_parquet</span>(db, <span class="st">"legislators_terms"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>legislators <span class="ot">&lt;-</span> <span class="fu">load_parquet</span>(db, <span class="st">"legislators"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In addition to the two tables above, in this chapter I will use an additional data frame with data on congressional terms.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>congress_terms <span class="ot">&lt;-</span> <span class="fu">load_parquet</span>(db, <span class="st">"congress_terms"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="survival-data-the-basic-building-block" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="survival-data-the-basic-building-block"><span class="header-section-number">5.1</span> Survival data: The basic building block</h2>
<p><span class="citation" data-cites="singer2003longitudinal">Singer and Willett (<a href="references.html#ref-singer2003longitudinal" role="doc-biblioref">2003, 306</a>)</span> suggest that “researchers use <strong>survival analysis</strong> in a variety of contexts that share a common characterisit: interest centers on describing <em>whether events occur</em> or <em>when events occur</em>.”</p>
<section id="survival-once-only-events" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="survival-once-only-events"><span class="header-section-number">5.1.1</span> Survival: Once-only events</h3>
<p>I suggest that the canonical form of data for survival analysis is a table with the following columns:</p>
<ul>
<li>Identifier: One more columns that identify the individuals in the sample. In the legislator data, this would be <code>id_bioguide</code>.</li>
<li>Entry date: The relevant start date for the individual</li>
<li>Event date: The date, if any, on which the relevant event occurs for the individual.</li>
</ul>
<p>Most queries involving cohorts in <a href="original_sql.html" class="quarto-xref"><span>Chapter 2</span></a> do not use a survivorship approach.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> The queries using a survivorship approach are given in <a href="original_sql.html#sec-survivorship" class="quarto-xref"><span>Section 2.4.1</span></a>.</p>
<p>Before moving on to discuss the census-date approach, I spend some time considering the approaches used in <a href="original_sql.html#sec-survivorship" class="quarto-xref"><span>Section 2.4.1</span></a>. The first query <span class="citation" data-cites="tanimura2021sql">(<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">Tanimura 2021, 154–55</a>)</span> effectively organizes the data into the canonical form for survival data with <code>first_century</code> as the cohort, except that the exit date is measured as <code>term_start</code> for each legislator’s last term.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> In effect, any gaps in a legislator’s term are filled in in the sense that any legislator with a term covering any period after five years would be deemed to have “survived” for five years.</p>
<p>What is not clear from <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span> is why one would prefer “survivorship” analysis (with filling-in) over “retention” analysis, as there is no real context given for the queries. One example that is given does not help much: “if we are concerned about the number of students who are still in school after a certain number of years, we could look for the absence of a graduation event in a data set” <span class="citation" data-cites="tanimura2021sql">(<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">Tanimura 2021, 154</a>)</span>. But suppose our cohort comprises students who begin high school, where high school is understood as covering grades 9 through 12. It would not seem correct to treat a student who completed grades 9 and 10, then dropped out for a year before returning to complete the eleventh grade and then dropping out again as having “survived” four years of high school.</p>
</section>
<section id="survival-censoring" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="survival-censoring"><span class="header-section-number">5.1.2</span> Survival: Censoring</h3>
<p>Note that we will often not observe event dates for many observations due to <strong>censoring</strong>. While events may be inevitable for any given individual (the proverbial death and taxes), such events need not occur during the period covered by the sample under study. This fact may not always be obvious from the data set in question.</p>
<p>To illustrate this point, I consider the legislators data . It is important to recognize that the data in <code>legislators</code> and <code>legislators_terms</code> were obtained at some unspecified date in the past.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>max_term_start <span class="ot">&lt;-</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  legislators_terms <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">max</span>(term_start, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>max_term_start</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2020-05-19"</code></pre>
</div>
</div>
<p>As we can see there are no terms in the data <em>starting</em> after the November 2020 election, suggesting that the data were extracted before terms related to that election started. Looking at the <code>term_end</code> dates, we see that no member of the House of Representatives (<code>term_type == "rep"</code>) has a term ending after 3 January 2021.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>legislators_terms <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term_end <span class="sc">&gt;=</span> max_term_start) <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(term_type, term_end) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(term_type, term_end)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_hhs51yf29egnfx4worog(i, j, css_id) {
          var table = document.getElementById("tinytable_hhs51yf29egnfx4worog");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_hhs51yf29egnfx4worog');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_hhs51yf29egnfx4worog(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_hhs51yf29egnfx4worog");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 1, j: 0 }, { i: 2, j: 0 }, { i: 4, j: 0 }, { i: 5, j: 0 }, { i: 3, j: 1 }, { i: 3, j: 0 }, { i: 1, j: 1 }, { i: 2, j: 1 }, { i: 4, j: 1 }, { i: 5, j: 1 },  ], css_id: 'tinytable_css_vjnm7276z5yyz1w6v6nk',}, 
          { positions: [ { i: 1, j: 2 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 4, j: 2 }, { i: 5, j: 2 },  ], css_id: 'tinytable_css_s62ozj1n5rxb301ys5rn',}, 
          { positions: [ { i: 6, j: 2 },  ], css_id: 'tinytable_css_k3ee7k744fwgd38itzb1',}, 
          { positions: [ { i: 6, j: 0 }, { i: 6, j: 1 },  ], css_id: 'tinytable_css_6yffri66sjkjmvjm256p',}, 
          { positions: [ { i: 0, j: 2 },  ], css_id: 'tinytable_css_32xv9a4dvbw3683fg38s',}, 
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 1 },  ], css_id: 'tinytable_css_2a7lpg8299bu3f1eke3g',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_hhs51yf29egnfx4worog(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_vjnm7276z5yyz1w6v6nk, .table th.tinytable_css_vjnm7276z5yyz1w6v6nk { padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_s62ozj1n5rxb301ys5rn, .table th.tinytable_css_s62ozj1n5rxb301ys5rn { padding-bottom: 0em; }
      .table td.tinytable_css_k3ee7k744fwgd38itzb1, .table th.tinytable_css_k3ee7k744fwgd38itzb1 { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_6yffri66sjkjmvjm256p, .table th.tinytable_css_6yffri66sjkjmvjm256p { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_32xv9a4dvbw3683fg38s, .table th.tinytable_css_32xv9a4dvbw3683fg38s { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_2a7lpg8299bu3f1eke3g, .table th.tinytable_css_2a7lpg8299bu3f1eke3g { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_hhs51yf29egnfx4worog" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">term_type</th>
                <th scope="col">term_end</th>
                <th scope="col">n</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>rep</td>
                  <td>2020-05-22</td>
                  <td>  1</td>
                </tr>
                <tr>
                  <td>rep</td>
                  <td>2021-01-03</td>
                  <td>437</td>
                </tr>
                <tr>
                  <td>sen</td>
                  <td>2020-11-03</td>
                  <td>  1</td>
                </tr>
                <tr>
                  <td>sen</td>
                  <td>2021-01-03</td>
                  <td> 34</td>
                </tr>
                <tr>
                  <td>sen</td>
                  <td>2023-01-03</td>
                  <td> 32</td>
                </tr>
                <tr>
                  <td>sen</td>
                  <td>2025-01-03</td>
                  <td> 33</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>As we are in “the future” with regard to whenever the legislators data were extracted, we can gain some insight into when the data were collected by looking at the data we can get today from the GitHub repository from which the data were obtained. The data on legislators’ terms are divided into two JSON files—one for current legislators and one for past legislators. Using JSON wrangling of the kind I have <a href="https://github.com/iangow/notes/blob/main/sec_submissions.pdf">written about in the past</a>, <code>get_terms()</code> processes either of these two files and returns a data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>get_terms <span class="ot">&lt;-</span> <span class="cf">function</span>(file) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"https://theunitedstates.io/congress-legislators/"</span>, file)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">json =</span> <span class="fu">list</span>(<span class="fu">read_json</span>(url))) <span class="sc">|&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_longer</span>(json) <span class="sc">|&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_wider</span>(json) <span class="sc">|&gt;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(id, terms) <span class="sc">|&gt;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_wider</span>(id) <span class="sc">|&gt;</span> </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(bioguide, terms) <span class="sc">|&gt;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_longer</span>(terms) <span class="sc">|&gt;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_wider</span>(terms) <span class="sc">|&gt;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(bioguide, type, start, end, state, district, </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>           party, url,  class) <span class="sc">|&gt;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename_with</span>(\(x) <span class="fu">str_c</span>(<span class="st">"term_"</span>, x), <span class="fu">c</span>(type, start, end)) <span class="sc">|&gt;</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">id_bioguide =</span> bioguide)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I apply <code>get_terms()</code> twice to get the data and combine them and push them to the DuckDB database instance containing the older data sets we have.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>updated_terms <span class="ot">&lt;-</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_terms</span>(<span class="st">"legislators-current.json"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">get_terms</span>(<span class="st">"legislators-historical.json"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">copy_to</span>(db, <span class="at">df =</span> _, <span class="at">name =</span> <span class="st">"updated_terms"</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, I join the old and new data and look for case where the updated <code>term_end</code> differs from that in the older data set. Such cases are shown in <a href="#tbl-changed-term-ends" class="quarto-xref">Table&nbsp;<span>5.1</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>updated_term_ends <span class="ot">&lt;-</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  legislators <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_bioguide, full_name) <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(updated_terms, <span class="at">by =</span> <span class="st">"id_bioguide"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(legislators_terms,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id_bioguide"</span>, <span class="st">"term_start"</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_updated"</span>, <span class="st">""</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term_end <span class="sc">!=</span> term_end_updated) <span class="sc">|&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(full_name, term_type, term_start, term_end,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>         term_end_updated) <span class="sc">|&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(term_end_updated) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div id="tbl-changed-term-ends" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-changed-term-ends-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5.1: Legislators with changed <code>term_end</code> values in updated data
</figcaption>
<div aria-describedby="tbl-changed-term-ends-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_bmcp73l1w59c1dzialhv(i, j, css_id) {
          var table = document.getElementById("tinytable_bmcp73l1w59c1dzialhv");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_bmcp73l1w59c1dzialhv');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_bmcp73l1w59c1dzialhv(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_bmcp73l1w59c1dzialhv");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 0, j: 4 },  ], css_id: 'tinytable_css_xionu59dymqa3hvw8rkc',}, 
          { positions: [ { i: 8, j: 4 },  ], css_id: 'tinytable_css_t8dltgg40kdk5b588vx8',}, 
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 3 }, { i: 0, j: 2 }, { i: 0, j: 1 },  ], css_id: 'tinytable_css_ljou014v74d3swmm2pnk',}, 
          { positions: [ { i: 1, j: 4 }, { i: 2, j: 4 }, { i: 3, j: 4 }, { i: 4, j: 4 }, { i: 5, j: 4 }, { i: 6, j: 4 }, { i: 7, j: 4 },  ], css_id: 'tinytable_css_jbgkvn7d96ief6zbcoz3',}, 
          { positions: [ { i: 8, j: 2 }, { i: 8, j: 1 }, { i: 8, j: 0 }, { i: 8, j: 3 },  ], css_id: 'tinytable_css_7lsenoxoo4p62rivfnza',}, 
          { positions: [ { i: 2, j: 0 }, { i: 3, j: 0 }, { i: 4, j: 0 }, { i: 6, j: 0 }, { i: 7, j: 0 }, { i: 3, j: 2 }, { i: 1, j: 1 }, { i: 2, j: 1 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 1, j: 0 }, { i: 6, j: 1 }, { i: 7, j: 1 }, { i: 3, j: 3 }, { i: 5, j: 0 }, { i: 1, j: 2 }, { i: 2, j: 2 }, { i: 7, j: 3 }, { i: 4, j: 2 }, { i: 5, j: 2 }, { i: 6, j: 2 }, { i: 7, j: 2 }, { i: 5, j: 1 }, { i: 1, j: 3 }, { i: 2, j: 3 }, { i: 4, j: 3 }, { i: 5, j: 3 }, { i: 6, j: 3 },  ], css_id: 'tinytable_css_6oezf1fprtnehim09m5b',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_bmcp73l1w59c1dzialhv(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_xionu59dymqa3hvw8rkc, .table th.tinytable_css_xionu59dymqa3hvw8rkc { font-size: 0.8em; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_t8dltgg40kdk5b588vx8, .table th.tinytable_css_t8dltgg40kdk5b588vx8 { font-size: 0.8em; border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_ljou014v74d3swmm2pnk, .table th.tinytable_css_ljou014v74d3swmm2pnk { font-size: 0.8em; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_jbgkvn7d96ief6zbcoz3, .table th.tinytable_css_jbgkvn7d96ief6zbcoz3 { font-size: 0.8em; padding-bottom: 0em; }
      .table td.tinytable_css_7lsenoxoo4p62rivfnza, .table th.tinytable_css_7lsenoxoo4p62rivfnza { font-size: 0.8em; border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_6oezf1fprtnehim09m5b, .table th.tinytable_css_6oezf1fprtnehim09m5b { font-size: 0.8em; padding-right: 0.1em; padding-bottom: 0em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_bmcp73l1w59c1dzialhv" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">full_name</th>
                <th scope="col">term_type</th>
                <th scope="col">term_start</th>
                <th scope="col">term_end</th>
                <th scope="col">term_end_updated</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>John Lewis      </td>
                  <td>rep</td>
                  <td>2019-01-03</td>
                  <td>2021-01-03</td>
                  <td>2020-07-17</td>
                </tr>
                <tr>
                  <td>Tom Graves      </td>
                  <td>rep</td>
                  <td>2019-01-03</td>
                  <td>2021-01-03</td>
                  <td>2020-10-04</td>
                </tr>
                <tr>
                  <td>Martha McSally  </td>
                  <td>sen</td>
                  <td>2019-01-03</td>
                  <td>2021-01-03</td>
                  <td>2020-12-02</td>
                </tr>
                <tr>
                  <td>Paul Cook       </td>
                  <td>rep</td>
                  <td>2019-01-03</td>
                  <td>2021-01-03</td>
                  <td>2020-12-07</td>
                </tr>
                <tr>
                  <td>Kamala D. Harris</td>
                  <td>sen</td>
                  <td>2017-01-03</td>
                  <td>2023-01-03</td>
                  <td>2021-01-18</td>
                </tr>
                <tr>
                  <td>Kelly Loeffler  </td>
                  <td>sen</td>
                  <td>2020-01-06</td>
                  <td>2020-11-03</td>
                  <td>2021-01-20</td>
                </tr>
                <tr>
                  <td>Dianne Feinstein</td>
                  <td>sen</td>
                  <td>2019-01-03</td>
                  <td>2025-01-03</td>
                  <td>2023-09-28</td>
                </tr>
                <tr>
                  <td>Robert Menendez </td>
                  <td>sen</td>
                  <td>2019-01-03</td>
                  <td>2025-01-03</td>
                  <td>2024-08-20</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>
<p>Looking at the table, we see that the earliest updated <code>term_end</code> relates to John Lewis, a civil rights icon and long-time legislator who passed away on 17 July 2020. It seems reasonable to assume that the data were collated prior to that date and, lacking more precise information, I assume that the extraction date was 30 June 2020.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>extract_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2020-06-30"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once we fix <code>extract_date</code>, we should consider all <code>term_end</code> dates after that date as merely <em>expected</em> <code>term_end</code> dates, as subsequent events might have led to some members of Congress to finish their terms early. For this reason, it might seem appropriate to code such <code>term_end</code> values as “don’t know” or <code>NA</code> (<code>NULL</code> in SQL). This is especially so when we view <code>last_term</code> as representing the end of a legislator’ career, as we simply don’t know when a legislator’s career will end. But coding the data in this way would lead to a loss of the information impounded in the fact that a legislator’s term has extended at least as far as 30 June 2020. For this reason, the standard approach is to code <code>term_end</code> as the last observed date and create an indicator variable that informs users of the data that the data have been censored for this observation. The following code creates <code>survival_data</code>, a data frame containing legislator data in canonical survival form. A sample of these data is provided in <a href="#tbl-survival-canonical" class="quarto-xref">Table&nbsp;<span>5.2</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>survival_data <span class="ot">&lt;-</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  legislators_terms <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_bioguide) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">entry_date =</span> <span class="fu">min</span>(term_start, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">exit_date =</span> <span class="fu">max</span>(term_end, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">censored =</span> exit_date <span class="sc">&gt;</span> extract_date,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">exit_date =</span> <span class="fu">if_else</span>(censored, extract_date, exit_date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>survival_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-survival-canonical" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-survival-canonical-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5.2: Legislator data in canonical survival form
</figcaption>
<div aria-describedby="tbl-survival-canonical-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_t2lzja7rywoi7egw2bvb(i, j, css_id) {
          var table = document.getElementById("tinytable_t2lzja7rywoi7egw2bvb");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_t2lzja7rywoi7egw2bvb');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_t2lzja7rywoi7egw2bvb(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_t2lzja7rywoi7egw2bvb");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 10, j: 3 },  ], css_id: 'tinytable_css_t3k0wfjhcnehk5h1jiuq',}, 
          { positions: [ { i: 0, j: 3 },  ], css_id: 'tinytable_css_s1ix7awkus7kmpad3g6q',}, 
          { positions: [ { i: 1, j: 3 }, { i: 2, j: 3 }, { i: 3, j: 3 }, { i: 4, j: 3 }, { i: 5, j: 3 }, { i: 6, j: 3 }, { i: 7, j: 3 }, { i: 8, j: 3 }, { i: 9, j: 3 },  ], css_id: 'tinytable_css_fx7b4eek0dk9s43tl9w4',}, 
          { positions: [ { i: 10, j: 1 }, { i: 10, j: 0 }, { i: 10, j: 2 },  ], css_id: 'tinytable_css_9hvi3goxkxdaquvzl7rk',}, 
          { positions: [ { i: 2, j: 0 }, { i: 4, j: 0 }, { i: 1, j: 0 }, { i: 6, j: 0 }, { i: 3, j: 0 }, { i: 8, j: 0 }, { i: 5, j: 0 }, { i: 1, j: 2 }, { i: 7, j: 0 }, { i: 1, j: 1 }, { i: 2, j: 1 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 5, j: 1 }, { i: 6, j: 1 }, { i: 7, j: 1 }, { i: 8, j: 1 }, { i: 9, j: 1 }, { i: 3, j: 2 }, { i: 9, j: 0 }, { i: 5, j: 2 }, { i: 2, j: 2 }, { i: 7, j: 2 }, { i: 4, j: 2 }, { i: 9, j: 2 }, { i: 6, j: 2 }, { i: 8, j: 2 },  ], css_id: 'tinytable_css_6zlhviz9x43rgbb8yns2',}, 
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 2 }, { i: 0, j: 1 },  ], css_id: 'tinytable_css_2vsxdcikeemxc5im36r8',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_t2lzja7rywoi7egw2bvb(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_t3k0wfjhcnehk5h1jiuq, .table th.tinytable_css_t3k0wfjhcnehk5h1jiuq { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_s1ix7awkus7kmpad3g6q, .table th.tinytable_css_s1ix7awkus7kmpad3g6q { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_fx7b4eek0dk9s43tl9w4, .table th.tinytable_css_fx7b4eek0dk9s43tl9w4 { padding-bottom: 0em; }
      .table td.tinytable_css_9hvi3goxkxdaquvzl7rk, .table th.tinytable_css_9hvi3goxkxdaquvzl7rk { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_6zlhviz9x43rgbb8yns2, .table th.tinytable_css_6zlhviz9x43rgbb8yns2 { padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_2vsxdcikeemxc5im36r8, .table th.tinytable_css_2vsxdcikeemxc5im36r8 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_t2lzja7rywoi7egw2bvb" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">id_bioguide</th>
                <th scope="col">entry_date</th>
                <th scope="col">exit_date</th>
                <th scope="col">censored</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>T000464</td>
                  <td>2007-01-04</td>
                  <td>2020-06-30</td>
                  <td>TRUE</td>
                </tr>
                <tr>
                  <td>W000802</td>
                  <td>2007-01-04</td>
                  <td>2020-06-30</td>
                  <td>TRUE</td>
                </tr>
                <tr>
                  <td>M001176</td>
                  <td>2009-01-06</td>
                  <td>2020-06-30</td>
                  <td>TRUE</td>
                </tr>
                <tr>
                  <td>R000584</td>
                  <td>2009-01-06</td>
                  <td>2020-06-30</td>
                  <td>TRUE</td>
                </tr>
                <tr>
                  <td>C001110</td>
                  <td>2017-01-03</td>
                  <td>2020-06-30</td>
                  <td>TRUE</td>
                </tr>
                <tr>
                  <td>B001267</td>
                  <td>2009-01-22</td>
                  <td>2020-06-30</td>
                  <td>TRUE</td>
                </tr>
                <tr>
                  <td>C001094</td>
                  <td>2013-01-03</td>
                  <td>2020-06-30</td>
                  <td>TRUE</td>
                </tr>
                <tr>
                  <td>B001250</td>
                  <td>2003-01-07</td>
                  <td>2020-06-30</td>
                  <td>TRUE</td>
                </tr>
                <tr>
                  <td>S001193</td>
                  <td>2013-01-03</td>
                  <td>2020-06-30</td>
                  <td>TRUE</td>
                </tr>
                <tr>
                  <td>B000574</td>
                  <td>1996-05-21</td>
                  <td>2020-06-30</td>
                  <td>TRUE</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>
<p><span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span> does not address the issue of censoring. This likely reflects the emphasis of that book on preparing data for descriptive analysis in business contexts rather than on more sophisticated statistical analysis, such as that appearing in scientific journals. However, it is important to account for censoring for many practical business questions. For instance, Chapter 7 of <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span> discusses experimental analysis and one could imagine looking at the effects on customer retention of some marketing initiative using A/B testing of the kind studied there. In this sitation, it will be common for the retention periods for some customers to be censored.</p>
<p>It is worth noting that what I am calling a canonical form for survival data differs from what <span class="citation" data-cites="singer2003longitudinal">Singer and Willett (<a href="references.html#ref-singer2003longitudinal" role="doc-biblioref">2003</a>)</span> call the <strong>person-level</strong> form of data. The main difference in the person-level form seen in Figure 10.4 of <span class="citation" data-cites="singer2003longitudinal">Singer and Willett (<a href="references.html#ref-singer2003longitudinal" role="doc-biblioref">2003, 353</a>)</span> is that (using variable names from our current context) <code>entry_date</code> and <code>exit_date</code> have been converted into a “time to event” form reflecting the number of units of time between <code>entry_date</code> and <code>exit_date</code>. One corollary of this aspect of the person-level form is, as pointed out by <span class="citation" data-cites="singer2003longitudinal">Singer and Willett (<a href="references.html#ref-singer2003longitudinal" role="doc-biblioref">2003, 310</a>)</span>, a need to specify a “metric for clocking time” (e.g., days or years). With the canonical data form I present here, I effectively <em>defer</em> the need to choose the metric; as will be seen one cannot <em>avoid</em> this choice.</p>
</section>
<section id="sec-census-date" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="sec-census-date"><span class="header-section-number">5.1.3</span> Events that can happen more than once: The census-date approach</h3>
<p>In many contexts, the event of interest will be a once-only event. In some cases, the one-off nature of the event will be a function of the underlying realities (e.g., <em>senso strictu</em> survivorship analysis in which individuals only die once). In other cases, the one-off nature of the event will derive from the definition employed by the researcher (e.g., first relapse in the study of alcoholism above). The latter set might be driven by what is of greatest interest to researchers, or the definition may lead to simplifications with analytical benefits.</p>
<p>However in many cases it will be important to recognize that events can occur for an individual more than once. A subscription streaming service such as Netflix or Max will have customers who sign up for a monthly subscription, drop off some months later, then rejoin at a later date. Ignoring this behaviour in analysis would be problematic if it is common enough to represent a significant portion of a service’s business.</p>
<p>There are two approaches to addressing these situations. One approach is to focus analysis on “whether the cohort member has a record in the time series on a particular date, expressed as a number of periods from the starting date” <span class="citation" data-cites="tanimura2021sql">(<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">Tanimura 2021, 124</a>)</span>. There is a little ambiguity embedded in this sentence regarding how the term “period” is defined. One definition turns on dates specific to an individual, such as age, which is typically reckoned as the number of birthdays an individual has experienced.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> Another definition, which I call the <strong>census-date approach</strong>, reckons periods using a common date across individuals or cohorts.</p>
<p>Each census-date analysis in <a href="original_sql.html" class="quarto-xref"><span>Chapter 2</span></a> uses 31 December of each year as the census date. For reasons we will learn about in <a href="#sec-stints" class="quarto-xref"><span>Section 5.1.4</span></a>, the choice of 31 December is appropriate because the <em>apparent</em> gaps that appear in the tenures of legislators in certain parts of the year do not affect 31 December. To implement this approach, I use the data frame <code>year_ends</code> below, which I create in R before copying to DuckDB.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>year_ends <span class="ot">&lt;-</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">year =</span> <span class="dv">1770</span><span class="sc">:</span><span class="dv">2030</span>L) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ymd</span>(<span class="fu">str_c</span>(year, <span class="st">"-12-31"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">copy_to</span>(db, <span class="at">df =</span> _, <span class="at">name =</span> <span class="st">"year_ends"</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-stints" class="level3" data-number="5.1.4">
<h3 data-number="5.1.4" class="anchored" data-anchor-id="sec-stints"><span class="header-section-number">5.1.4</span> Events that can happen more than once: Stints</h3>
<p>The Oxford English Dictionary defines a <strong>stint</strong> as “a person’s fixed or allotted period of work.” In the current context, I define a stint as a continuous period in office either as a representive or as a senator including periods that comprise multiple terms. The critical thing for current purposes is that one can have more than one stint as a legislator. One could have one stint as representative, followed by a stint as senator, followed by a second stint as representative. An alternative term a stint might be a <strong>spell</strong>, as used by <span class="citation" data-cites="singer2003longitudinal">Singer and Willett (<a href="references.html#ref-singer2003longitudinal" role="doc-biblioref">2003, 311</a>)</span> in a quote above.</p>
<p>As always, to better understand the issues one faces in practice, it is helpful to look at real data. I start with data in <code>legislators_terms</code> related to Nancy Pelosi, a long-serving representative from California.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>pelosi_terms <span class="ot">&lt;-</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  legislators_terms <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id_bioguide <span class="sc">==</span> <span class="st">"P000197"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_bioguide, term_type, term_start, term_end, state, district)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div id="tbl-pelosi-terms" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-pelosi-terms-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5.3: Congression terms of Nancy Pelosi
</figcaption>
<div aria-describedby="tbl-pelosi-terms-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_0sxsg3hfouo6zp87v3f1(i, j, css_id) {
          var table = document.getElementById("tinytable_0sxsg3hfouo6zp87v3f1");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_0sxsg3hfouo6zp87v3f1');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_0sxsg3hfouo6zp87v3f1(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_0sxsg3hfouo6zp87v3f1");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 1 }, { i: 0, j: 3 }, { i: 0, j: 4 }, { i: 0, j: 2 },  ], css_id: 'tinytable_css_xkso75bpjq0w9ymdtei3',}, 
          { positions: [ { i: 17, j: 5 },  ], css_id: 'tinytable_css_mmjnk4xq0yxb85zp375r',}, 
          { positions: [ { i: 1, j: 5 }, { i: 2, j: 5 }, { i: 3, j: 5 }, { i: 4, j: 5 }, { i: 5, j: 5 }, { i: 6, j: 5 }, { i: 7, j: 5 }, { i: 8, j: 5 }, { i: 9, j: 5 }, { i: 10, j: 5 }, { i: 11, j: 5 }, { i: 12, j: 5 }, { i: 13, j: 5 }, { i: 14, j: 5 }, { i: 15, j: 5 }, { i: 16, j: 5 },  ], css_id: 'tinytable_css_k86j6mtylmwcfi6mjbhh',}, 
          { positions: [ { i: 17, j: 2 }, { i: 17, j: 0 }, { i: 17, j: 1 }, { i: 17, j: 3 }, { i: 17, j: 4 },  ], css_id: 'tinytable_css_it3g5mf0kyz33xklpfo6',}, 
          { positions: [ { i: 0, j: 5 },  ], css_id: 'tinytable_css_f5oqz9fpg2m3hfdt8w5b',}, 
          { positions: [ { i: 4, j: 0 }, { i: 1, j: 0 }, { i: 3, j: 0 }, { i: 8, j: 0 }, { i: 9, j: 0 }, { i: 6, j: 0 }, { i: 11, j: 0 }, { i: 12, j: 0 }, { i: 13, j: 0 }, { i: 14, j: 0 }, { i: 2, j: 0 }, { i: 16, j: 0 }, { i: 12, j: 1 }, { i: 5, j: 0 }, { i: 1, j: 1 }, { i: 7, j: 0 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 10, j: 0 }, { i: 6, j: 1 }, { i: 7, j: 1 }, { i: 8, j: 1 }, { i: 9, j: 1 }, { i: 15, j: 0 }, { i: 11, j: 1 }, { i: 7, j: 2 }, { i: 13, j: 1 }, { i: 14, j: 1 }, { i: 2, j: 1 }, { i: 16, j: 1 }, { i: 12, j: 2 }, { i: 5, j: 1 }, { i: 1, j: 2 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 4, j: 2 }, { i: 10, j: 1 }, { i: 6, j: 2 }, { i: 2, j: 3 }, { i: 8, j: 2 }, { i: 9, j: 2 }, { i: 15, j: 1 }, { i: 11, j: 2 }, { i: 7, j: 3 }, { i: 13, j: 2 }, { i: 14, j: 2 }, { i: 15, j: 2 }, { i: 16, j: 2 }, { i: 12, j: 3 }, { i: 5, j: 2 }, { i: 1, j: 3 }, { i: 15, j: 3 }, { i: 3, j: 3 }, { i: 4, j: 3 }, { i: 10, j: 2 }, { i: 6, j: 3 }, { i: 2, j: 4 }, { i: 8, j: 3 }, { i: 9, j: 3 }, { i: 10, j: 3 }, { i: 11, j: 3 }, { i: 7, j: 4 }, { i: 13, j: 3 }, { i: 14, j: 3 }, { i: 10, j: 4 }, { i: 16, j: 3 }, { i: 12, j: 4 }, { i: 5, j: 3 }, { i: 1, j: 4 }, { i: 15, j: 4 }, { i: 3, j: 4 }, { i: 4, j: 4 }, { i: 5, j: 4 }, { i: 6, j: 4 }, { i: 11, j: 4 }, { i: 8, j: 4 }, { i: 9, j: 4 }, { i: 14, j: 4 }, { i: 16, j: 4 }, { i: 13, j: 4 },  ], css_id: 'tinytable_css_4c0t5u15pvura3n3pzbo',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_0sxsg3hfouo6zp87v3f1(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_xkso75bpjq0w9ymdtei3, .table th.tinytable_css_xkso75bpjq0w9ymdtei3 { font-size: 0.8em; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_mmjnk4xq0yxb85zp375r, .table th.tinytable_css_mmjnk4xq0yxb85zp375r { font-size: 0.8em; border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_k86j6mtylmwcfi6mjbhh, .table th.tinytable_css_k86j6mtylmwcfi6mjbhh { font-size: 0.8em; padding-bottom: 0em; }
      .table td.tinytable_css_it3g5mf0kyz33xklpfo6, .table th.tinytable_css_it3g5mf0kyz33xklpfo6 { font-size: 0.8em; border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_f5oqz9fpg2m3hfdt8w5b, .table th.tinytable_css_f5oqz9fpg2m3hfdt8w5b { font-size: 0.8em; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_4c0t5u15pvura3n3pzbo, .table th.tinytable_css_4c0t5u15pvura3n3pzbo { font-size: 0.8em; padding-right: 0.1em; padding-bottom: 0em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_0sxsg3hfouo6zp87v3f1" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">id_bioguide</th>
                <th scope="col">term_type</th>
                <th scope="col">term_start</th>
                <th scope="col">term_end</th>
                <th scope="col">state</th>
                <th scope="col">district</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>1987-01-06</td>
                  <td>1989-01-03</td>
                  <td>CA</td>
                  <td> 5</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>1989-01-03</td>
                  <td>1991-01-03</td>
                  <td>CA</td>
                  <td> 5</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>1991-01-03</td>
                  <td>1993-01-03</td>
                  <td>CA</td>
                  <td> 5</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>1993-01-05</td>
                  <td>1995-01-03</td>
                  <td>CA</td>
                  <td> 8</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>1995-01-04</td>
                  <td>1997-01-03</td>
                  <td>CA</td>
                  <td> 8</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>1997-01-07</td>
                  <td>1999-01-03</td>
                  <td>CA</td>
                  <td> 8</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>1999-01-06</td>
                  <td>2001-01-03</td>
                  <td>CA</td>
                  <td> 8</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>2001-01-03</td>
                  <td>2003-01-03</td>
                  <td>CA</td>
                  <td> 8</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>2003-01-07</td>
                  <td>2005-01-03</td>
                  <td>CA</td>
                  <td> 8</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>2005-01-04</td>
                  <td>2007-01-03</td>
                  <td>CA</td>
                  <td> 8</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>2007-01-04</td>
                  <td>2009-01-03</td>
                  <td>CA</td>
                  <td> 8</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>2009-01-06</td>
                  <td>2011-01-03</td>
                  <td>CA</td>
                  <td> 8</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>2011-01-05</td>
                  <td>2013-01-03</td>
                  <td>CA</td>
                  <td> 8</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>2013-01-03</td>
                  <td>2015-01-03</td>
                  <td>CA</td>
                  <td>12</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>2015-01-06</td>
                  <td>2017-01-03</td>
                  <td>CA</td>
                  <td>12</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>2017-01-03</td>
                  <td>2019-01-03</td>
                  <td>CA</td>
                  <td>12</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>2019-01-03</td>
                  <td>2021-01-03</td>
                  <td>CA</td>
                  <td>12</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>
<p>As can be seen in <a href="#tbl-pelosi-terms" class="quarto-xref">Table&nbsp;<span>5.3</span></a>, Nancy Pelosi had served continuously since 1987.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> She started out as the repsentative for California’s 5th congressional district, then for its 8th, then for its 12th.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> In other words, Pelosi has had a single stint as a legislator.</p>
<p>It might seem from Nancy Pelosi’s later terms that we could identify continuing stints by comparing <code>term_start</code> with the preceding <code>term_end</code> value and coding two terms as part of the same stint if the dates are the same. This approach would work, for example, for the term starting <code>2019-01-03</code> and the preceding term ending the same day.</p>
<p>However, if we calculate <code>gap</code>, the number of days between the end of the previous term and the start of the current one, we see that there is often a non-zero gap between terms as coded in the <code>legislators_terms</code> data set. This can be seen in <a href="#tbl-pelosi-term-gaps" class="quarto-xref">Table&nbsp;<span>5.4</span></a>, which presents data from <code>pelosi_term_gaps</code> calculated below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>pelosi_term_gaps <span class="ot">&lt;-</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  pelosi_terms <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_bioguide) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">window_order</span>(term_start) <span class="sc">|&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gap =</span> term_start <span class="sc">-</span> <span class="fu">lag</span>(term_end)) <span class="sc">|&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_bioguide, term_type, term_start, term_end, gap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div id="tbl-pelosi-term-gaps" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-pelosi-term-gaps-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5.4: Congression terms of Nancy Pelosi with <code>gap</code>
</figcaption>
<div aria-describedby="tbl-pelosi-term-gaps-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_7cdmt505xo4g8tanz01w(i, j, css_id) {
          var table = document.getElementById("tinytable_7cdmt505xo4g8tanz01w");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_7cdmt505xo4g8tanz01w');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_7cdmt505xo4g8tanz01w(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_7cdmt505xo4g8tanz01w");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 8, j: 4 },  ], css_id: 'tinytable_css_f0gxopq06nebopr2s4ar',}, 
          { positions: [ { i: 0, j: 4 },  ], css_id: 'tinytable_css_dw7d5f8ztyhi6m37an5z',}, 
          { positions: [ { i: 8, j: 2 }, { i: 8, j: 1 }, { i: 8, j: 0 }, { i: 8, j: 3 },  ], css_id: 'tinytable_css_8wenfr9one7uz4v0ly9g',}, 
          { positions: [ { i: 1, j: 4 }, { i: 2, j: 4 }, { i: 3, j: 4 }, { i: 4, j: 4 }, { i: 5, j: 4 }, { i: 6, j: 4 }, { i: 7, j: 4 },  ], css_id: 'tinytable_css_66cn7h8yjlh477eqatdf',}, 
          { positions: [ { i: 2, j: 0 }, { i: 3, j: 0 }, { i: 4, j: 0 }, { i: 6, j: 0 }, { i: 7, j: 0 }, { i: 3, j: 2 }, { i: 1, j: 1 }, { i: 2, j: 1 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 1, j: 0 }, { i: 6, j: 1 }, { i: 7, j: 1 }, { i: 3, j: 3 }, { i: 5, j: 0 }, { i: 1, j: 2 }, { i: 2, j: 2 }, { i: 7, j: 3 }, { i: 4, j: 2 }, { i: 5, j: 2 }, { i: 6, j: 2 }, { i: 7, j: 2 }, { i: 5, j: 1 }, { i: 1, j: 3 }, { i: 2, j: 3 }, { i: 4, j: 3 }, { i: 5, j: 3 }, { i: 6, j: 3 },  ], css_id: 'tinytable_css_65e4551artzkng1dnlgc',}, 
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 3 }, { i: 0, j: 2 }, { i: 0, j: 1 },  ], css_id: 'tinytable_css_1pqei48960has8cxmgo5',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_7cdmt505xo4g8tanz01w(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_f0gxopq06nebopr2s4ar, .table th.tinytable_css_f0gxopq06nebopr2s4ar { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_dw7d5f8ztyhi6m37an5z, .table th.tinytable_css_dw7d5f8ztyhi6m37an5z { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_8wenfr9one7uz4v0ly9g, .table th.tinytable_css_8wenfr9one7uz4v0ly9g { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_66cn7h8yjlh477eqatdf, .table th.tinytable_css_66cn7h8yjlh477eqatdf { padding-bottom: 0em; }
      .table td.tinytable_css_65e4551artzkng1dnlgc, .table th.tinytable_css_65e4551artzkng1dnlgc { padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_1pqei48960has8cxmgo5, .table th.tinytable_css_1pqei48960has8cxmgo5 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_7cdmt505xo4g8tanz01w" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">id_bioguide</th>
                <th scope="col">term_type</th>
                <th scope="col">term_start</th>
                <th scope="col">term_end</th>
                <th scope="col">gap</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>1987-01-06</td>
                  <td>1989-01-03</td>
                  <td>NA</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>1989-01-03</td>
                  <td>1991-01-03</td>
                  <td> 0</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>1991-01-03</td>
                  <td>1993-01-03</td>
                  <td> 0</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>1993-01-05</td>
                  <td>1995-01-03</td>
                  <td> 2</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>1995-01-04</td>
                  <td>1997-01-03</td>
                  <td> 1</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>1997-01-07</td>
                  <td>1999-01-03</td>
                  <td> 4</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>1999-01-06</td>
                  <td>2001-01-03</td>
                  <td> 3</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>rep</td>
                  <td>2001-01-03</td>
                  <td>2003-01-03</td>
                  <td> 0</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>
<p>In <a href="#tbl-pelosi-term-gaps" class="quarto-xref">Table&nbsp;<span>5.4</span></a>, we can see that there are gaps of as much as 4 days between the end of one term and the start of the next. These gaps would be problematic for a census-date approach that used 4 January as the census date, as Nancy Pelosi would appear <em>not</em> to be a legislator on that date in 1993, 1997, or 1999. In contrast, the census-date approach using 31 December would not be affected by these gaps.</p>
<p>The shortness of the gaps above raises the possibility that one approach would be to consider two terms to be part of the same stint if there is just a short gap between them. But what is a “short gap” for this purpose? Would four days suffice? Looking at the terms of James Abdnor (<code>id_bioguide == "A000009")</code>) in <a href="#tbl-abdnor-term-gaps" class="quarto-xref">Table&nbsp;<span>5.5</span></a> suggests not.</p>
<div class="cell">
<div id="tbl-abdnor-term-gaps" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-abdnor-term-gaps-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5.5: Congression terms of James Abdnor
</figcaption>
<div aria-describedby="tbl-abdnor-term-gaps-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_8yn0k03bkhnbglum42ac(i, j, css_id) {
          var table = document.getElementById("tinytable_8yn0k03bkhnbglum42ac");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_8yn0k03bkhnbglum42ac');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_8yn0k03bkhnbglum42ac(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_8yn0k03bkhnbglum42ac");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 5, j: 0 }, { i: 5, j: 1 }, { i: 5, j: 2 }, { i: 5, j: 3 },  ], css_id: 'tinytable_css_uzqo5cz1ptsroa4kxbu9',}, 
          { positions: [ { i: 5, j: 4 },  ], css_id: 'tinytable_css_pzxr9z36kbemqcaelpn9',}, 
          { positions: [ { i: 1, j: 0 }, { i: 3, j: 0 }, { i: 3, j: 1 }, { i: 1, j: 1 }, { i: 4, j: 0 }, { i: 1, j: 2 }, { i: 2, j: 0 }, { i: 3, j: 2 }, { i: 2, j: 1 }, { i: 3, j: 3 }, { i: 4, j: 1 }, { i: 1, j: 3 }, { i: 4, j: 2 }, { i: 2, j: 2 }, { i: 2, j: 3 }, { i: 4, j: 3 },  ], css_id: 'tinytable_css_6t8r1xoxh36riyit753y',}, 
          { positions: [ { i: 0, j: 4 },  ], css_id: 'tinytable_css_4i8dfu560idwmwuh37kw',}, 
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 1 }, { i: 0, j: 2 }, { i: 0, j: 3 },  ], css_id: 'tinytable_css_47c1lczmb0z83nkc3zkd',}, 
          { positions: [ { i: 1, j: 4 }, { i: 2, j: 4 }, { i: 3, j: 4 }, { i: 4, j: 4 },  ], css_id: 'tinytable_css_1pxbp4571l2w0ohy3mra',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_8yn0k03bkhnbglum42ac(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_uzqo5cz1ptsroa4kxbu9, .table th.tinytable_css_uzqo5cz1ptsroa4kxbu9 { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_pzxr9z36kbemqcaelpn9, .table th.tinytable_css_pzxr9z36kbemqcaelpn9 { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_6t8r1xoxh36riyit753y, .table th.tinytable_css_6t8r1xoxh36riyit753y { padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_4i8dfu560idwmwuh37kw, .table th.tinytable_css_4i8dfu560idwmwuh37kw { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_47c1lczmb0z83nkc3zkd, .table th.tinytable_css_47c1lczmb0z83nkc3zkd { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_1pxbp4571l2w0ohy3mra, .table th.tinytable_css_1pxbp4571l2w0ohy3mra { padding-bottom: 0em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_8yn0k03bkhnbglum42ac" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">id_bioguide</th>
                <th scope="col">term_type</th>
                <th scope="col">term_start</th>
                <th scope="col">term_end</th>
                <th scope="col">gap</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>A000009</td>
                  <td>rep</td>
                  <td>1973-01-03</td>
                  <td>1975-01-03</td>
                  <td>NA</td>
                </tr>
                <tr>
                  <td>A000009</td>
                  <td>rep</td>
                  <td>1975-01-14</td>
                  <td>1977-01-03</td>
                  <td>11</td>
                </tr>
                <tr>
                  <td>A000009</td>
                  <td>rep</td>
                  <td>1977-01-04</td>
                  <td>1979-01-03</td>
                  <td> 1</td>
                </tr>
                <tr>
                  <td>A000009</td>
                  <td>rep</td>
                  <td>1979-01-15</td>
                  <td>1981-01-03</td>
                  <td>12</td>
                </tr>
                <tr>
                  <td>A000009</td>
                  <td>sen</td>
                  <td>1981-01-05</td>
                  <td>1987-01-03</td>
                  <td> 2</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>
<p>So maybe a month (say 30 days)? Looking at the terms of John Quincy Adams (<code>id_bioguide == "A000041")</code>) in <a href="#tbl-adams-term-gaps" class="quarto-xref">Table&nbsp;<span>5.6</span></a>, it seems this would not work.</p>
<div class="cell">
<div id="tbl-adams-term-gaps" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-adams-term-gaps-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5.6: Congression terms of John Quincy Adams
</figcaption>
<div aria-describedby="tbl-adams-term-gaps-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_5b49au3at9v3mr51zew0(i, j, css_id) {
          var table = document.getElementById("tinytable_5b49au3at9v3mr51zew0");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_5b49au3at9v3mr51zew0');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_5b49au3at9v3mr51zew0(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_5b49au3at9v3mr51zew0");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 10, j: 2 }, { i: 10, j: 0 }, { i: 10, j: 1 }, { i: 10, j: 3 },  ], css_id: 'tinytable_css_ty3lspd8mi27a9yqsvu6',}, 
          { positions: [ { i: 0, j: 4 },  ], css_id: 'tinytable_css_qbw4umdws0kssci7hbk3',}, 
          { positions: [ { i: 1, j: 4 }, { i: 2, j: 4 }, { i: 3, j: 4 }, { i: 4, j: 4 }, { i: 5, j: 4 }, { i: 6, j: 4 }, { i: 7, j: 4 }, { i: 8, j: 4 }, { i: 9, j: 4 },  ], css_id: 'tinytable_css_p8djscxildrvikfehxmg',}, 
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 2 }, { i: 0, j: 3 }, { i: 0, j: 1 },  ], css_id: 'tinytable_css_lj8x90chktdfwnpvrdps',}, 
          { positions: [ { i: 2, j: 0 }, { i: 4, j: 0 }, { i: 1, j: 0 }, { i: 6, j: 0 }, { i: 8, j: 0 }, { i: 5, j: 0 }, { i: 1, j: 2 }, { i: 3, j: 0 }, { i: 1, j: 1 }, { i: 2, j: 1 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 5, j: 1 }, { i: 6, j: 1 }, { i: 7, j: 1 }, { i: 8, j: 1 }, { i: 7, j: 0 }, { i: 1, j: 3 }, { i: 9, j: 0 }, { i: 3, j: 3 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 4, j: 2 }, { i: 5, j: 2 }, { i: 6, j: 2 }, { i: 7, j: 2 }, { i: 8, j: 2 }, { i: 9, j: 2 }, { i: 7, j: 3 }, { i: 9, j: 1 }, { i: 5, j: 3 }, { i: 2, j: 3 }, { i: 4, j: 3 }, { i: 9, j: 3 }, { i: 6, j: 3 }, { i: 8, j: 3 },  ], css_id: 'tinytable_css_jbjwjl4leajnprsi1evu',}, 
          { positions: [ { i: 10, j: 4 },  ], css_id: 'tinytable_css_5lsah8xc54wciovoi40x',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_5b49au3at9v3mr51zew0(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_ty3lspd8mi27a9yqsvu6, .table th.tinytable_css_ty3lspd8mi27a9yqsvu6 { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_qbw4umdws0kssci7hbk3, .table th.tinytable_css_qbw4umdws0kssci7hbk3 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_p8djscxildrvikfehxmg, .table th.tinytable_css_p8djscxildrvikfehxmg { padding-bottom: 0em; }
      .table td.tinytable_css_lj8x90chktdfwnpvrdps, .table th.tinytable_css_lj8x90chktdfwnpvrdps { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_jbjwjl4leajnprsi1evu, .table th.tinytable_css_jbjwjl4leajnprsi1evu { padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_5lsah8xc54wciovoi40x, .table th.tinytable_css_5lsah8xc54wciovoi40x { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_5b49au3at9v3mr51zew0" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">id_bioguide</th>
                <th scope="col">term_type</th>
                <th scope="col">term_start</th>
                <th scope="col">term_end</th>
                <th scope="col">gap</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>A000041</td>
                  <td>sen</td>
                  <td>1803-10-17</td>
                  <td>1809-03-03</td>
                  <td>  NA</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1831-12-05</td>
                  <td>1833-03-03</td>
                  <td>8312</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1833-12-02</td>
                  <td>1835-03-03</td>
                  <td> 274</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1835-12-07</td>
                  <td>1837-03-03</td>
                  <td> 279</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1837-09-04</td>
                  <td>1839-03-03</td>
                  <td> 185</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1839-12-02</td>
                  <td>1841-03-03</td>
                  <td> 274</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1841-05-31</td>
                  <td>1843-03-03</td>
                  <td>  89</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1843-12-04</td>
                  <td>1845-03-03</td>
                  <td> 276</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1845-12-01</td>
                  <td>1847-03-03</td>
                  <td> 273</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1847-12-06</td>
                  <td>1849-03-03</td>
                  <td> 278</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>
<p>What’s going on here? If we go to the <a href="https://www.senate.gov/legislative/DatesofSessionsofCongress.htm">website of the United States Senate</a>, we can see that sessions of Congress often began later in the year in the 19th century. Furthermore, the <code>term_start</code> data in <code>legislators_terms</code> appear to be based on the dates on which legislative sessions started. Data on these dates—derived from the United States Senate website—are contained in <code>congress_terms</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>congress_terms <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(congress <span class="sc">&lt;=</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_h6dx3kn7bj513z53ogwe(i, j, css_id) {
          var table = document.getElementById("tinytable_h6dx3kn7bj513z53ogwe");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_h6dx3kn7bj513z53ogwe');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_h6dx3kn7bj513z53ogwe(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_h6dx3kn7bj513z53ogwe");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 1 },  ], css_id: 'tinytable_css_xt0jtza8fjc6dtnpxww6',}, 
          { positions: [ { i: 5, j: 0 }, { i: 5, j: 1 },  ], css_id: 'tinytable_css_ly3ep0e8zkrerljh6lw5',}, 
          { positions: [ { i: 1, j: 0 }, { i: 3, j: 0 }, { i: 4, j: 0 }, { i: 3, j: 1 }, { i: 2, j: 0 }, { i: 1, j: 1 }, { i: 2, j: 1 }, { i: 4, j: 1 },  ], css_id: 'tinytable_css_d1713pvhw63bynfnmbhw',}, 
          { positions: [ { i: 5, j: 2 },  ], css_id: 'tinytable_css_croij4uitcif4fs2qq9j',}, 
          { positions: [ { i: 1, j: 2 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 4, j: 2 },  ], css_id: 'tinytable_css_ar26k321f1q7grjmviiu',}, 
          { positions: [ { i: 0, j: 2 },  ], css_id: 'tinytable_css_6z13oe6ch3khxv693tvr',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_h6dx3kn7bj513z53ogwe(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_xt0jtza8fjc6dtnpxww6, .table th.tinytable_css_xt0jtza8fjc6dtnpxww6 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_ly3ep0e8zkrerljh6lw5, .table th.tinytable_css_ly3ep0e8zkrerljh6lw5 { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_d1713pvhw63bynfnmbhw, .table th.tinytable_css_d1713pvhw63bynfnmbhw { padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_croij4uitcif4fs2qq9j, .table th.tinytable_css_croij4uitcif4fs2qq9j { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_ar26k321f1q7grjmviiu, .table th.tinytable_css_ar26k321f1q7grjmviiu { padding-bottom: 0em; }
      .table td.tinytable_css_6z13oe6ch3khxv693tvr, .table th.tinytable_css_6z13oe6ch3khxv693tvr { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_h6dx3kn7bj513z53ogwe" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">congress</th>
                <th scope="col">term_start</th>
                <th scope="col">term_end</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>1</td>
                  <td>1789-03-04</td>
                  <td>1791-03-03</td>
                </tr>
                <tr>
                  <td>2</td>
                  <td>1791-10-24</td>
                  <td>1793-03-03</td>
                </tr>
                <tr>
                  <td>3</td>
                  <td>1793-12-02</td>
                  <td>1795-03-03</td>
                </tr>
                <tr>
                  <td>4</td>
                  <td>1795-12-07</td>
                  <td>1797-03-03</td>
                </tr>
                <tr>
                  <td>5</td>
                  <td>1797-05-15</td>
                  <td>1799-03-03</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>congress_terms <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(congress <span class="sc">&gt;=</span> <span class="dv">114</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_bnbh1jq53epu45z3loip(i, j, css_id) {
          var table = document.getElementById("tinytable_bnbh1jq53epu45z3loip");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_bnbh1jq53epu45z3loip');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_bnbh1jq53epu45z3loip(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_bnbh1jq53epu45z3loip");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 1 },  ], css_id: 'tinytable_css_n6lk8m2fwec67nsx1n6e',}, 
          { positions: [ { i: 5, j: 2 },  ], css_id: 'tinytable_css_gy27j46jup7vip8aqkl7',}, 
          { positions: [ { i: 5, j: 0 }, { i: 5, j: 1 },  ], css_id: 'tinytable_css_fcjm5elwbshl6ywizty5',}, 
          { positions: [ { i: 1, j: 2 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 4, j: 2 },  ], css_id: 'tinytable_css_aj6v972qfs091cc4kouy',}, 
          { positions: [ { i: 0, j: 2 },  ], css_id: 'tinytable_css_8ysbocvrig0z794fw9d5',}, 
          { positions: [ { i: 1, j: 0 }, { i: 3, j: 0 }, { i: 4, j: 0 }, { i: 3, j: 1 }, { i: 2, j: 0 }, { i: 1, j: 1 }, { i: 2, j: 1 }, { i: 4, j: 1 },  ], css_id: 'tinytable_css_5z2xb9a7oipk72hzcgvu',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_bnbh1jq53epu45z3loip(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_n6lk8m2fwec67nsx1n6e, .table th.tinytable_css_n6lk8m2fwec67nsx1n6e { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_gy27j46jup7vip8aqkl7, .table th.tinytable_css_gy27j46jup7vip8aqkl7 { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_fcjm5elwbshl6ywizty5, .table th.tinytable_css_fcjm5elwbshl6ywizty5 { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_aj6v972qfs091cc4kouy, .table th.tinytable_css_aj6v972qfs091cc4kouy { padding-bottom: 0em; }
      .table td.tinytable_css_8ysbocvrig0z794fw9d5, .table th.tinytable_css_8ysbocvrig0z794fw9d5 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_5z2xb9a7oipk72hzcgvu, .table th.tinytable_css_5z2xb9a7oipk72hzcgvu { padding-right: 0.1em; padding-bottom: 0em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_bnbh1jq53epu45z3loip" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">congress</th>
                <th scope="col">term_start</th>
                <th scope="col">term_end</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>114</td>
                  <td>2015-01-06</td>
                  <td>2017-01-03</td>
                </tr>
                <tr>
                  <td>115</td>
                  <td>2017-01-03</td>
                  <td>2019-01-03</td>
                </tr>
                <tr>
                  <td>116</td>
                  <td>2019-01-03</td>
                  <td>2021-01-03</td>
                </tr>
                <tr>
                  <td>117</td>
                  <td>2021-01-03</td>
                  <td>2023-01-03</td>
                </tr>
                <tr>
                  <td>118</td>
                  <td>2023-01-03</td>
                  <td>2025-01-03</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Fortunately, each congress ends in the same year as the succeeding one starts:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>congress_terms <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">window_order</span>(term_start) <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">same_year =</span> <span class="fu">year</span>(term_start) <span class="sc">!=</span> <span class="fu">year</span>(<span class="fu">lag</span>(term_end)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_53upkdnww753zgoq48ji(i, j, css_id) {
          var table = document.getElementById("tinytable_53upkdnww753zgoq48ji");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_53upkdnww753zgoq48ji');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_53upkdnww753zgoq48ji(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_53upkdnww753zgoq48ji");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 2, j: 0 },  ], css_id: 'tinytable_css_png7g1lqadsof9hfmh5i',}, 
          { positions: [ { i: 1, j: 1 },  ], css_id: 'tinytable_css_per4ae3n17spmfvloj6w',}, 
          { positions: [ { i: 0, j: 0 },  ], css_id: 'tinytable_css_p5773nhakydbklyt07fm',}, 
          { positions: [ { i: 1, j: 0 },  ], css_id: 'tinytable_css_mtvorw97iwlgl8zkux7i',}, 
          { positions: [ { i: 0, j: 1 },  ], css_id: 'tinytable_css_bcc0w63vudbjq3kzve3z',}, 
          { positions: [ { i: 2, j: 1 },  ], css_id: 'tinytable_css_4kzpvmiq2ubpv0yb8l0a',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_53upkdnww753zgoq48ji(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_png7g1lqadsof9hfmh5i, .table th.tinytable_css_png7g1lqadsof9hfmh5i { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_per4ae3n17spmfvloj6w, .table th.tinytable_css_per4ae3n17spmfvloj6w { padding-bottom: 0em; }
      .table td.tinytable_css_p5773nhakydbklyt07fm, .table th.tinytable_css_p5773nhakydbklyt07fm { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_mtvorw97iwlgl8zkux7i, .table th.tinytable_css_mtvorw97iwlgl8zkux7i { padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_bcc0w63vudbjq3kzve3z, .table th.tinytable_css_bcc0w63vudbjq3kzve3z { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_4kzpvmiq2ubpv0yb8l0a, .table th.tinytable_css_4kzpvmiq2ubpv0yb8l0a { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_53upkdnww753zgoq48ji" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">same_year</th>
                <th scope="col">n</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>FALSE</td>
                  <td>117</td>
                </tr>
                <tr>
                  <td>   NA</td>
                  <td>  1</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Using this fact and going term by term for each legislator and term type, we can identify a new stint for a legislator as one where there is no preceding term (i.e., the first stint) or the preceding term does not end in the same year as the current one. Note that, because I group by <code>id_bioguide</code> and <code>term_type</code>, if the preceding term was of a different type (<code>rep</code> or <code>sen</code>) from the current one, then the current term will be considered as starting a new stint. We can then number each stint by summing the numeric values of <code>new_stint</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>stints_raw <span class="ot">&lt;-</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  legislators_terms <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_bioguide, term_type) <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">window_order</span>(term_start) <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">same_year =</span> <span class="fu">year</span>(term_start) <span class="sc">==</span> <span class="fu">year</span>(<span class="fu">lag</span>(term_end)),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">new_stint =</span> <span class="fu">is.na</span>(same_year) <span class="sc">|</span> <span class="sc">!</span>same_year) <span class="sc">|&gt;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_bioguide) <span class="sc">|&gt;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">window_order</span>(term_start) <span class="sc">|&gt;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stint_number =</span> <span class="fu">cumsum</span>(<span class="fu">as.integer</span>(new_stint))) <span class="sc">|&gt;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id_bioguide, term_start) <span class="sc">|&gt;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_bioguide, term_type, term_start, term_end, </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>         same_year, new_stint, stint_number) <span class="sc">|&gt;</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After adding <code>stint_number</code> to the data on legislator terms, we can organize the data by stints, which reduces the size of the data and facilitates analysis by stint. I store this reduced data set in <code>stints</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>stints <span class="ot">&lt;-</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  stints_raw <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_bioguide, term_type, stint_number) <span class="sc">|&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">stint_start =</span> <span class="fu">min</span>(term_start, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">stint_end =</span> <span class="fu">max</span>(term_end, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can revisit the three legislators discussed at the start of this section to confirm that they are organized in <code>stints</code> in the way we would expect. As can be seen in <a href="#tbl-stints-examples" class="quarto-xref">Table&nbsp;<span>5.7</span></a>, we have two stints each for James Abdnor and John Quincy Adams and one sting for Nancy Pelosi.</p>
<div class="cell">
<div id="tbl-stints-examples" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-stints-examples-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5.7: Congressional stints of example legislators
</figcaption>
<div aria-describedby="tbl-stints-examples-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_d5gvoapday1rkvc8e1b4(i, j, css_id) {
          var table = document.getElementById("tinytable_d5gvoapday1rkvc8e1b4");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_d5gvoapday1rkvc8e1b4');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_d5gvoapday1rkvc8e1b4(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_d5gvoapday1rkvc8e1b4");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 3 }, { i: 0, j: 1 }, { i: 0, j: 4 }, { i: 0, j: 2 },  ], css_id: 'tinytable_css_z0lco1d8aevkac07m2qp',}, 
          { positions: [ { i: 1, j: 0 }, { i: 2, j: 0 }, { i: 3, j: 0 }, { i: 4, j: 0 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 1, j: 1 }, { i: 2, j: 1 }, { i: 1, j: 2 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 4, j: 2 }, { i: 3, j: 3 }, { i: 4, j: 3 }, { i: 1, j: 3 }, { i: 2, j: 3 }, { i: 1, j: 4 }, { i: 2, j: 4 }, { i: 3, j: 4 }, { i: 4, j: 4 },  ], css_id: 'tinytable_css_epiwtdh1teim2xxnycyj',}, 
          { positions: [ { i: 5, j: 2 }, { i: 5, j: 0 }, { i: 5, j: 3 }, { i: 5, j: 1 }, { i: 5, j: 4 },  ], css_id: 'tinytable_css_92px73m9ib45ylxm2tdx',}, 
          { positions: [ { i: 5, j: 5 },  ], css_id: 'tinytable_css_8zyaw6syuzkdxc4r6l6o',}, 
          { positions: [ { i: 1, j: 5 }, { i: 2, j: 5 }, { i: 3, j: 5 }, { i: 4, j: 5 },  ], css_id: 'tinytable_css_6hcdln8w8pctcmi60uok',}, 
          { positions: [ { i: 0, j: 5 },  ], css_id: 'tinytable_css_2pmf069qiamwm73w4jpn',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_d5gvoapday1rkvc8e1b4(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_z0lco1d8aevkac07m2qp, .table th.tinytable_css_z0lco1d8aevkac07m2qp { font-size: 0.8em; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_epiwtdh1teim2xxnycyj, .table th.tinytable_css_epiwtdh1teim2xxnycyj { font-size: 0.8em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_92px73m9ib45ylxm2tdx, .table th.tinytable_css_92px73m9ib45ylxm2tdx { font-size: 0.8em; border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_8zyaw6syuzkdxc4r6l6o, .table th.tinytable_css_8zyaw6syuzkdxc4r6l6o { font-size: 0.8em; border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_6hcdln8w8pctcmi60uok, .table th.tinytable_css_6hcdln8w8pctcmi60uok { font-size: 0.8em; padding-bottom: 0em; }
      .table td.tinytable_css_2pmf069qiamwm73w4jpn, .table th.tinytable_css_2pmf069qiamwm73w4jpn { font-size: 0.8em; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_d5gvoapday1rkvc8e1b4" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">id_bioguide</th>
                <th scope="col">full_name</th>
                <th scope="col">term_type</th>
                <th scope="col">stint_number</th>
                <th scope="col">stint_start</th>
                <th scope="col">stint_end</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>A000009</td>
                  <td>James Abdnor     </td>
                  <td>rep</td>
                  <td>1</td>
                  <td>1973-01-03</td>
                  <td>1981-01-03</td>
                </tr>
                <tr>
                  <td>A000009</td>
                  <td>James Abdnor     </td>
                  <td>sen</td>
                  <td>2</td>
                  <td>1981-01-05</td>
                  <td>1987-01-03</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>John Quincy Adams</td>
                  <td>sen</td>
                  <td>1</td>
                  <td>1803-10-17</td>
                  <td>1809-03-03</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>John Quincy Adams</td>
                  <td>rep</td>
                  <td>2</td>
                  <td>1831-12-05</td>
                  <td>1849-03-03</td>
                </tr>
                <tr>
                  <td>P000197</td>
                  <td>Nancy Pelosi     </td>
                  <td>rep</td>
                  <td>1</td>
                  <td>1987-01-06</td>
                  <td>2021-01-03</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>
<p>Looking at <a href="#tbl-num-stints" class="quarto-xref">Table&nbsp;<span>5.8</span></a>, we see that there are two legislators with <em>six stints</em> each.</p>
<div class="cell">
<div id="tbl-num-stints" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-num-stints-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5.8: Distribution of number of stints
</figcaption>
<div aria-describedby="tbl-num-stints-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_nuipnmbd2ip3pjl158z1(i, j, css_id) {
          var table = document.getElementById("tinytable_nuipnmbd2ip3pjl158z1");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_nuipnmbd2ip3pjl158z1');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_nuipnmbd2ip3pjl158z1(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_nuipnmbd2ip3pjl158z1");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 6, j: 1 },  ], css_id: 'tinytable_css_y34rfj1vzb5ebp18o3mu',}, 
          { positions: [ { i: 1, j: 1 }, { i: 2, j: 1 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 5, j: 1 },  ], css_id: 'tinytable_css_qrf45y0r2ucx0reans16',}, 
          { positions: [ { i: 1, j: 0 }, { i: 2, j: 0 }, { i: 3, j: 0 }, { i: 4, j: 0 }, { i: 5, j: 0 },  ], css_id: 'tinytable_css_l6cm22h79ic1rqvpx90q',}, 
          { positions: [ { i: 0, j: 0 },  ], css_id: 'tinytable_css_icclpoz5u0ufkl6a9jxh',}, 
          { positions: [ { i: 0, j: 1 },  ], css_id: 'tinytable_css_b7e3x1ne8nvmwxv1jlda',}, 
          { positions: [ { i: 6, j: 0 },  ], css_id: 'tinytable_css_37rwn7nugjfhuf5tgnr3',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_nuipnmbd2ip3pjl158z1(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_y34rfj1vzb5ebp18o3mu, .table th.tinytable_css_y34rfj1vzb5ebp18o3mu { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_qrf45y0r2ucx0reans16, .table th.tinytable_css_qrf45y0r2ucx0reans16 { padding-bottom: 0em; }
      .table td.tinytable_css_l6cm22h79ic1rqvpx90q, .table th.tinytable_css_l6cm22h79ic1rqvpx90q { padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_icclpoz5u0ufkl6a9jxh, .table th.tinytable_css_icclpoz5u0ufkl6a9jxh { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_b7e3x1ne8nvmwxv1jlda, .table th.tinytable_css_b7e3x1ne8nvmwxv1jlda { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_37rwn7nugjfhuf5tgnr3, .table th.tinytable_css_37rwn7nugjfhuf5tgnr3 { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_nuipnmbd2ip3pjl158z1" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">stint_number</th>
                <th scope="col">n</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>1</td>
                  <td>12518</td>
                </tr>
                <tr>
                  <td>2</td>
                  <td> 1775</td>
                </tr>
                <tr>
                  <td>3</td>
                  <td>  250</td>
                </tr>
                <tr>
                  <td>4</td>
                  <td>   33</td>
                </tr>
                <tr>
                  <td>5</td>
                  <td>    7</td>
                </tr>
                <tr>
                  <td>6</td>
                  <td>    2</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>
<p>Is this an error? I collect data on these two legislators in <code>six_stinters</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>six_stinters <span class="ot">&lt;-</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  stints <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(stint_number <span class="sc">==</span> <span class="dv">6</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(id_bioguide) <span class="sc">|&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(legislators, <span class="at">by =</span> <span class="st">"id_bioguide"</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_bioguide, full_name) <span class="sc">|&gt;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(stints, <span class="at">by =</span> <span class="st">"id_bioguide"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id_bioguide, stint_start) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From <a href="#tbl-six-stints" class="quarto-xref">Table&nbsp;<span>5.9</span></a>, it seems that these are legitimately six-stint legislators. Henry Clay and John Randolph were major political figures over much of the first half of the nineteenth century. Some of their stints were broken by switches from one congressional body to another. Other stints were broken by stints in the executive branch: Clay was Secretary of State and Randolph spent a short time as the US ambassador to Russia.<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
<div class="cell">
<div id="tbl-six-stints" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-six-stints-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5.9: Legislators with six stints
</figcaption>
<div aria-describedby="tbl-six-stints-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_7vpbev4zxaa59uil9syc(i, j, css_id) {
          var table = document.getElementById("tinytable_7vpbev4zxaa59uil9syc");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_7vpbev4zxaa59uil9syc');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_7vpbev4zxaa59uil9syc(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_7vpbev4zxaa59uil9syc");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 1, j: 5 }, { i: 2, j: 5 }, { i: 3, j: 5 }, { i: 4, j: 5 }, { i: 5, j: 5 }, { i: 6, j: 5 }, { i: 7, j: 5 }, { i: 8, j: 5 }, { i: 9, j: 5 }, { i: 10, j: 5 }, { i: 11, j: 5 },  ], css_id: 'tinytable_css_zdckbq9icjsfbpqnvcyj',}, 
          { positions: [ { i: 12, j: 5 },  ], css_id: 'tinytable_css_tsnjjkrjbliyph3l22sa',}, 
          { positions: [ { i: 1, j: 0 }, { i: 2, j: 0 }, { i: 3, j: 0 }, { i: 4, j: 0 }, { i: 5, j: 0 }, { i: 6, j: 0 }, { i: 7, j: 0 }, { i: 8, j: 0 }, { i: 9, j: 0 }, { i: 10, j: 0 }, { i: 11, j: 0 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 1, j: 1 }, { i: 2, j: 1 }, { i: 7, j: 1 }, { i: 8, j: 1 }, { i: 5, j: 1 }, { i: 6, j: 1 }, { i: 11, j: 1 }, { i: 3, j: 2 }, { i: 9, j: 1 }, { i: 10, j: 1 }, { i: 2, j: 2 }, { i: 7, j: 2 }, { i: 4, j: 2 }, { i: 1, j: 2 }, { i: 6, j: 2 }, { i: 11, j: 2 }, { i: 8, j: 2 }, { i: 5, j: 2 }, { i: 10, j: 2 }, { i: 2, j: 3 }, { i: 3, j: 3 }, { i: 9, j: 2 }, { i: 1, j: 3 }, { i: 6, j: 3 }, { i: 7, j: 3 }, { i: 4, j: 3 }, { i: 5, j: 3 }, { i: 10, j: 3 }, { i: 11, j: 3 }, { i: 8, j: 3 }, { i: 9, j: 3 }, { i: 1, j: 4 }, { i: 2, j: 4 }, { i: 3, j: 4 }, { i: 4, j: 4 }, { i: 5, j: 4 }, { i: 6, j: 4 }, { i: 7, j: 4 }, { i: 8, j: 4 }, { i: 9, j: 4 }, { i: 10, j: 4 }, { i: 11, j: 4 },  ], css_id: 'tinytable_css_iyp9t131bvfpz8s0ucd8',}, 
          { positions: [ { i: 12, j: 0 }, { i: 12, j: 1 }, { i: 12, j: 2 }, { i: 12, j: 3 }, { i: 12, j: 4 },  ], css_id: 'tinytable_css_crhtvts08qojjo9617ue',}, 
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 1 }, { i: 0, j: 2 }, { i: 0, j: 3 }, { i: 0, j: 4 },  ], css_id: 'tinytable_css_azfl7kywzvll23h7qjc1',}, 
          { positions: [ { i: 0, j: 5 },  ], css_id: 'tinytable_css_9rju83m40djpiulre80q',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_7vpbev4zxaa59uil9syc(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_zdckbq9icjsfbpqnvcyj, .table th.tinytable_css_zdckbq9icjsfbpqnvcyj { font-size: 0.8em; padding-bottom: 0em; }
      .table td.tinytable_css_tsnjjkrjbliyph3l22sa, .table th.tinytable_css_tsnjjkrjbliyph3l22sa { font-size: 0.8em; border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_iyp9t131bvfpz8s0ucd8, .table th.tinytable_css_iyp9t131bvfpz8s0ucd8 { font-size: 0.8em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_crhtvts08qojjo9617ue, .table th.tinytable_css_crhtvts08qojjo9617ue { font-size: 0.8em; border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_azfl7kywzvll23h7qjc1, .table th.tinytable_css_azfl7kywzvll23h7qjc1 { font-size: 0.8em; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_9rju83m40djpiulre80q, .table th.tinytable_css_9rju83m40djpiulre80q { font-size: 0.8em; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_7vpbev4zxaa59uil9syc" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">id_bioguide</th>
                <th scope="col">full_name</th>
                <th scope="col">term_type</th>
                <th scope="col">stint_number</th>
                <th scope="col">stint_start</th>
                <th scope="col">stint_end</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>C000482</td>
                  <td>Henry Clay   </td>
                  <td>sen</td>
                  <td>1</td>
                  <td>1806-01-01</td>
                  <td>1807-03-03</td>
                </tr>
                <tr>
                  <td>C000482</td>
                  <td>Henry Clay   </td>
                  <td>sen</td>
                  <td>2</td>
                  <td>1810-01-01</td>
                  <td>1811-03-03</td>
                </tr>
                <tr>
                  <td>C000482</td>
                  <td>Henry Clay   </td>
                  <td>rep</td>
                  <td>3</td>
                  <td>1811-11-04</td>
                  <td>1821-03-03</td>
                </tr>
                <tr>
                  <td>C000482</td>
                  <td>Henry Clay   </td>
                  <td>rep</td>
                  <td>4</td>
                  <td>1823-12-01</td>
                  <td>1827-03-03</td>
                </tr>
                <tr>
                  <td>C000482</td>
                  <td>Henry Clay   </td>
                  <td>sen</td>
                  <td>5</td>
                  <td>1831-12-05</td>
                  <td>1843-03-03</td>
                </tr>
                <tr>
                  <td>C000482</td>
                  <td>Henry Clay   </td>
                  <td>sen</td>
                  <td>6</td>
                  <td>1849-12-03</td>
                  <td>1853-03-03</td>
                </tr>
                <tr>
                  <td>R000047</td>
                  <td>John Randolph</td>
                  <td>rep</td>
                  <td>1</td>
                  <td>1799-12-02</td>
                  <td>1813-03-03</td>
                </tr>
                <tr>
                  <td>R000047</td>
                  <td>John Randolph</td>
                  <td>rep</td>
                  <td>2</td>
                  <td>1815-12-04</td>
                  <td>1817-03-03</td>
                </tr>
                <tr>
                  <td>R000047</td>
                  <td>John Randolph</td>
                  <td>rep</td>
                  <td>3</td>
                  <td>1819-12-06</td>
                  <td>1825-12-26</td>
                </tr>
                <tr>
                  <td>R000047</td>
                  <td>John Randolph</td>
                  <td>sen</td>
                  <td>4</td>
                  <td>1825-12-26</td>
                  <td>1827-03-03</td>
                </tr>
                <tr>
                  <td>R000047</td>
                  <td>John Randolph</td>
                  <td>rep</td>
                  <td>5</td>
                  <td>1827-12-03</td>
                  <td>1829-03-03</td>
                </tr>
                <tr>
                  <td>R000047</td>
                  <td>John Randolph</td>
                  <td>rep</td>
                  <td>6</td>
                  <td>1833-12-02</td>
                  <td>1835-03-03</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>
<p>The fact that congressional terms always end in the same year as the following term begins means that we won’t miss terms that continue previous terms using the <code>year(term_start) == year(lag(term_end)))</code> rule. That is, we should have no “false negatives”.</p>
<p>But do we need to worry about “false positives”: cases where we classify a term as continuing the previous term when there is actually a gap between the two terms. To examine the possibility of false positives, I adapt the <code>stints</code> code above to create <code>problem_stints</code>, which contains terms that began <em>after</em> the start of the congressional term in that year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>problem_stints <span class="ot">&lt;-</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  legislators_terms <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_bioguide, term_type) <span class="sc">|&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">window_order</span>(term_start) <span class="sc">|&gt;</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_start =</span> <span class="fu">year</span>(term_start),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">same_year =</span> <span class="fu">year</span>(term_start) <span class="sc">==</span> <span class="fu">year</span>(<span class="fu">lag</span>(term_end))) <span class="sc">|&gt;</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    congress_terms <span class="sc">|&gt;</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">year_start =</span> <span class="fu">year</span>(term_start)),</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"year_start"</span>, </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"_congress"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(same_year, </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>         term_start <span class="sc">&gt;</span> term_start_congress) <span class="sc">|&gt;</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(legislators <span class="sc">|&gt;</span> <span class="fu">select</span>(id_bioguide, full_name),</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="st">"id_bioguide"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_bioguide, full_name, term_type, </span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>         term_start_congress, term_start) <span class="sc">|&gt;</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(term_start)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Candidate false positives are presented in <a href="#tbl-problem-stints" class="quarto-xref">Table&nbsp;<span>5.10</span></a>.</p>
<div class="cell">
<div id="tbl-problem-stints" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-problem-stints-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5.10: Possibly problematic stint data
</figcaption>
<div aria-describedby="tbl-problem-stints-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_lgukb4qs5yoxtxdftotk(i, j, css_id) {
          var table = document.getElementById("tinytable_lgukb4qs5yoxtxdftotk");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_lgukb4qs5yoxtxdftotk');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_lgukb4qs5yoxtxdftotk(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_lgukb4qs5yoxtxdftotk");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 7, j: 4 },  ], css_id: 'tinytable_css_vz1ndolbs1xfjbj5qapa',}, 
          { positions: [ { i: 1, j: 4 }, { i: 2, j: 4 }, { i: 3, j: 4 }, { i: 4, j: 4 }, { i: 5, j: 4 }, { i: 6, j: 4 },  ], css_id: 'tinytable_css_opcf5bsnigglwwbl51u3',}, 
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 2 }, { i: 0, j: 1 }, { i: 0, j: 3 },  ], css_id: 'tinytable_css_ld6le7pt6yqbrfus03iq',}, 
          { positions: [ { i: 7, j: 0 }, { i: 7, j: 2 }, { i: 7, j: 1 }, { i: 7, j: 3 },  ], css_id: 'tinytable_css_ee4adu5i358yt11qf0ee',}, 
          { positions: [ { i: 0, j: 4 },  ], css_id: 'tinytable_css_9tuhh1mizoe7v6uhadb5',}, 
          { positions: [ { i: 1, j: 0 }, { i: 2, j: 0 }, { i: 5, j: 0 }, { i: 6, j: 0 }, { i: 4, j: 0 }, { i: 1, j: 1 }, { i: 2, j: 1 }, { i: 4, j: 2 }, { i: 4, j: 1 }, { i: 5, j: 1 }, { i: 6, j: 1 }, { i: 4, j: 3 }, { i: 3, j: 0 }, { i: 1, j: 2 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 3, j: 1 }, { i: 5, j: 2 }, { i: 6, j: 2 }, { i: 3, j: 3 }, { i: 1, j: 3 }, { i: 2, j: 3 }, { i: 5, j: 3 }, { i: 6, j: 3 },  ], css_id: 'tinytable_css_0axsujvlazdhuc2owq4j',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_lgukb4qs5yoxtxdftotk(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_vz1ndolbs1xfjbj5qapa, .table th.tinytable_css_vz1ndolbs1xfjbj5qapa { font-size: 0.8em; border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_opcf5bsnigglwwbl51u3, .table th.tinytable_css_opcf5bsnigglwwbl51u3 { font-size: 0.8em; padding-bottom: 0em; }
      .table td.tinytable_css_ld6le7pt6yqbrfus03iq, .table th.tinytable_css_ld6le7pt6yqbrfus03iq { font-size: 0.8em; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_ee4adu5i358yt11qf0ee, .table th.tinytable_css_ee4adu5i358yt11qf0ee { font-size: 0.8em; border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_9tuhh1mizoe7v6uhadb5, .table th.tinytable_css_9tuhh1mizoe7v6uhadb5 { font-size: 0.8em; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_0axsujvlazdhuc2owq4j, .table th.tinytable_css_0axsujvlazdhuc2owq4j { font-size: 0.8em; padding-right: 0.1em; padding-bottom: 0em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_lgukb4qs5yoxtxdftotk" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">id_bioguide</th>
                <th scope="col">full_name</th>
                <th scope="col">term_type</th>
                <th scope="col">term_start_congress</th>
                <th scope="col">term_start</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>J000191</td>
                  <td>John Warfield Johnston </td>
                  <td>sen</td>
                  <td>1871-03-04</td>
                  <td>1871-03-15</td>
                </tr>
                <tr>
                  <td>T000116</td>
                  <td>Henry Moore Teller     </td>
                  <td>sen</td>
                  <td>1877-10-15</td>
                  <td>1877-12-05</td>
                </tr>
                <tr>
                  <td>W000088</td>
                  <td>Monrad Charles Wallgren</td>
                  <td>rep</td>
                  <td>1939-01-03</td>
                  <td>1939-01-05</td>
                </tr>
                <tr>
                  <td>D000585</td>
                  <td>Henry Clarence Dworshak</td>
                  <td>sen</td>
                  <td>1949-01-03</td>
                  <td>1949-10-14</td>
                </tr>
                <tr>
                  <td>G000465</td>
                  <td>Robert Paul Griffin    </td>
                  <td>rep</td>
                  <td>1965-01-04</td>
                  <td>1965-01-09</td>
                </tr>
                <tr>
                  <td>S001180</td>
                  <td>Kurt Schrader          </td>
                  <td>rep</td>
                  <td>2017-01-03</td>
                  <td>2017-01-10</td>
                </tr>
                <tr>
                  <td>J000255</td>
                  <td>Walter B. Jones        </td>
                  <td>rep</td>
                  <td>2019-01-03</td>
                  <td>2019-01-04</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>
<p>As with many data tasks, what is required to handle these is not some fancy coding or analysis, but simple “shoe leather” For example, take the latest case from <a href="#tbl-problem-stints" class="quarto-xref">Table&nbsp;<span>5.10</span></a>. According to <a href="https://www.oregonlive.com/politics/2017/01/oregon_congressman_kurt_schrad_1.html">The Oregonian</a>, Walter Jones missed being sworn in on <a href="https://clerk.house.gov/evs/2019/roll001.xml">the first day of the 116th Congress</a> because he was on honeymoon. Kurt Schrader is another who missed <a href="https://clerk.house.gov/evs/2017/roll001.xml">the first day of Congress</a>. The gaps are somewhat longer in the cases of Henry Moore Teller and Henry Clarence Dworchak.</p>
<p>Teller was one of the initial pair of senators from Colarado, which as admitted the 38th state of the United States on 1 August 1876. <a href="https://www.senate.gov/states/CO/timeline.htm">Initial digging</a> into the former case suggests that “the Senate confirmed the nomination of Henry Moore Teller as secretary of the interior under President Chester A. Arthur. Teller resigned his Senate seat on April 17, 1876, and served as interior secretary until March 3, 1885.” Hmm? So Teller resigned before Colarado was even a state to serve under Chester Arthur, who didn’t even become president until 1881. This is clearly a mistake (a giveaway is the apparent nine-year stint as cabinet secretary).</p>
</section>
<section id="why-use-census-dates" class="level3" data-number="5.1.5">
<h3 data-number="5.1.5" class="anchored" data-anchor-id="why-use-census-dates"><span class="header-section-number">5.1.5</span> Why use census dates?</h3>
<p>With events that happen at most once, there is no clear rationale for using either census dates or stints. Each observation will have just one stint (albeit with a potentially censored exit date) and, assuming that date of entry is <span class="math inline">\(t=0\)</span>, then being in the sample after date <span class="math inline">\(t=T\)</span> implies being in the sample on any census date between <span class="math inline">\(0\)</span> and <span class="math inline">\(T\)</span>.</p>
<p>Thus the differences between analyses using census dates and stints will arise when individuals can have multiple stints. So why use census dates rather than calculating stints?</p>
<p>I think one reason for using a census-date is that can be much easier to implement. Constructing stints for legislators required additional data (i.e., <code>congress_terms</code>) and a little data-wrangling gymnastics. In contrast, by using 31 December as the census date (a date unlikely to be in a “gap”), we can easily construct measures of tenure with less effort.</p>
<p>Additionally, the census-date appraoach makes it easy to implement the chosen “metric for clocking time” <span class="citation" data-cites="singer2003longitudinal">(<a href="references.html#ref-singer2003longitudinal" role="doc-biblioref">Singer and Willett 2003, 310</a>)</span>. By using <code>year_ends</code>, almost all examples in <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span> measure time in terms of years.</p>
</section>
</section>
<section id="organizing-cohort-data" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="organizing-cohort-data"><span class="header-section-number">5.2</span> Organizing cohort data</h2>
<p>There are several different cohorts uses in analyses in Chapter 4 of <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span>.</p>
<ul>
<li><code>first_year</code></li>
<li><code>first_century</code> (also called <code>cohort_century</code> or <code>century</code>)</li>
<li><code>first_state</code></li>
<li><code>gender</code></li>
<li><code>first_state</code> and <code>gender</code></li>
<li><code>term_type</code></li>
<li><code>first_century</code> and <code>first_type</code></li>
<li><code>date</code> (last day of the year) and <code>century</code> (<code>last_century</code>?)</li>
</ul>
<p>If you read <a href="original_sql.html" class="quarto-xref"><span>Chapter 2</span></a> carefully, you will see that any individual legislator is placed in no more than one of the cohorts above in any analysis. As such one particulaly clean (and clear) approach would create a table comprising the individual identifier (<code>id_bioguide</code>) and the cohort assignment for each individual. For example, the following code creates a <code>first_centuries</code> table with cohort assignments for <code>first_century</code> (here named <code>cohort</code> for reasons that will become clear in a moment).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>first_centuries <span class="ot">&lt;-</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  legislators_terms <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_bioguide) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">cohort =</span> <span class="fu">century</span>(<span class="fu">min</span>(term_start, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that not all analyses in <a href="original_sql.html" class="quarto-xref"><span>Chapter 2</span></a> involve cohorts. For example, the analysis of tenures <span class="citation" data-cites="tanimura2021sql">(<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">Tanimura 2021, 170–74</a>)</span> is described as “rather than cohorting on <code>first_term</code>, we can cohort on tenure instead.” But I feel it is a little confusing to describe this analysis as involving “cohorting” as any individual legislator will appear in multiple cohorts over time.<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>first_terms <span class="ot">&lt;-</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  legislators_terms <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_bioguide) <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">first_term =</span> <span class="fu">min</span>(term_start, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>census_data <span class="ot">&lt;-</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  legislators_terms <span class="sc">|&gt;</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(first_terms, <span class="at">by =</span> <span class="st">"id_bioguide"</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(year_ends, </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">join_by</span>(</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">between</span>(y<span class="sc">$</span>date, x<span class="sc">$</span>term_start, x<span class="sc">$</span>term_end))) <span class="sc">|&gt;</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">coalesce</span>(<span class="fu">year</span>(<span class="fu">age</span>(date, first_term)), <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The cohort analysis can now proceed by combining these two data frames and calculating <code>pct_retained</code> after a few data steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>cen_pct_retaineds <span class="ot">&lt;-</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  first_centuries <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(census_data, <span class="at">by =</span> <span class="st">"id_bioguide"</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cohort, period) <span class="sc">|&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">cohort_retained =</span> <span class="fu">n_distinct</span>(id_bioguide),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cohort) <span class="sc">|&gt;</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">window_order</span>(period) <span class="sc">|&gt;</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cohort_size =</span> <span class="fu">first</span>(cohort_retained)) <span class="sc">|&gt;</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_retained =</span> cohort_retained <span class="sc">/</span> cohort_size) <span class="sc">|&gt;</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cohort, period, cohort_size, cohort_retained,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>         pct_retained) <span class="sc">|&gt;</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(cohort, period)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>cen_pct_retaineds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_nqnf7ebrqemfjolno2xa(i, j, css_id) {
          var table = document.getElementById("tinytable_nqnf7ebrqemfjolno2xa");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_nqnf7ebrqemfjolno2xa');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_nqnf7ebrqemfjolno2xa(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_nqnf7ebrqemfjolno2xa");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 1, j: 4 }, { i: 2, j: 4 }, { i: 3, j: 4 }, { i: 4, j: 4 }, { i: 5, j: 4 }, { i: 6, j: 4 }, { i: 7, j: 4 }, { i: 8, j: 4 }, { i: 9, j: 4 },  ], css_id: 'tinytable_css_ui8cd9eubinlb9y8j20p',}, 
          { positions: [ { i: 0, j: 4 },  ], css_id: 'tinytable_css_khp6hseajbtqe81c6a42',}, 
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 2 }, { i: 0, j: 3 }, { i: 0, j: 1 },  ], css_id: 'tinytable_css_jx10hqd92znunsp1gtdg',}, 
          { positions: [ { i: 10, j: 2 }, { i: 10, j: 0 }, { i: 10, j: 1 }, { i: 10, j: 3 },  ], css_id: 'tinytable_css_4rq1yrozk59fnufcpj45',}, 
          { positions: [ { i: 10, j: 4 },  ], css_id: 'tinytable_css_1cz7urziek4l79093k9e',}, 
          { positions: [ { i: 2, j: 0 }, { i: 4, j: 0 }, { i: 1, j: 0 }, { i: 6, j: 0 }, { i: 8, j: 0 }, { i: 5, j: 0 }, { i: 1, j: 2 }, { i: 3, j: 0 }, { i: 1, j: 1 }, { i: 2, j: 1 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 5, j: 1 }, { i: 6, j: 1 }, { i: 7, j: 1 }, { i: 8, j: 1 }, { i: 7, j: 0 }, { i: 1, j: 3 }, { i: 9, j: 0 }, { i: 3, j: 3 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 4, j: 2 }, { i: 5, j: 2 }, { i: 6, j: 2 }, { i: 7, j: 2 }, { i: 8, j: 2 }, { i: 9, j: 2 }, { i: 7, j: 3 }, { i: 9, j: 1 }, { i: 5, j: 3 }, { i: 2, j: 3 }, { i: 4, j: 3 }, { i: 9, j: 3 }, { i: 6, j: 3 }, { i: 8, j: 3 },  ], css_id: 'tinytable_css_0rlrkhbbfm2upx5r62x8',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_nqnf7ebrqemfjolno2xa(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_ui8cd9eubinlb9y8j20p, .table th.tinytable_css_ui8cd9eubinlb9y8j20p { padding-bottom: 0em; }
      .table td.tinytable_css_khp6hseajbtqe81c6a42, .table th.tinytable_css_khp6hseajbtqe81c6a42 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_jx10hqd92znunsp1gtdg, .table th.tinytable_css_jx10hqd92znunsp1gtdg { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_4rq1yrozk59fnufcpj45, .table th.tinytable_css_4rq1yrozk59fnufcpj45 { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_1cz7urziek4l79093k9e, .table th.tinytable_css_1cz7urziek4l79093k9e { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_0rlrkhbbfm2upx5r62x8, .table th.tinytable_css_0rlrkhbbfm2upx5r62x8 { padding-right: 0.1em; padding-bottom: 0em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_nqnf7ebrqemfjolno2xa" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">cohort</th>
                <th scope="col">period</th>
                <th scope="col">cohort_size</th>
                <th scope="col">cohort_retained</th>
                <th scope="col">pct_retained</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>18</td>
                  <td>0</td>
                  <td>368</td>
                  <td>368</td>
                  <td>1.0000000</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>1</td>
                  <td>368</td>
                  <td>360</td>
                  <td>0.9782609</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>2</td>
                  <td>368</td>
                  <td>242</td>
                  <td>0.6576087</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>3</td>
                  <td>368</td>
                  <td>233</td>
                  <td>0.6331522</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>4</td>
                  <td>368</td>
                  <td>149</td>
                  <td>0.4048913</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>5</td>
                  <td>368</td>
                  <td>144</td>
                  <td>0.3913043</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>6</td>
                  <td>368</td>
                  <td> 99</td>
                  <td>0.2690217</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>7</td>
                  <td>368</td>
                  <td>101</td>
                  <td>0.2744565</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>8</td>
                  <td>368</td>
                  <td> 73</td>
                  <td>0.1983696</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>9</td>
                  <td>368</td>
                  <td> 70</td>
                  <td>0.1902174</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Of course, this logic could be embedded in a function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>get_pct_retained <span class="ot">&lt;-</span> <span class="cf">function</span>(cohorts, census_data) {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  cohorts <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(census_data, <span class="at">by =</span> <span class="st">"id_bioguide"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cohort, period) <span class="sc">|&gt;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">cohort_retained =</span> <span class="fu">n_distinct</span>(id_bioguide),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cohort) <span class="sc">|&gt;</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">window_order</span>(period) <span class="sc">|&gt;</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cohort_size =</span> <span class="fu">first</span>(cohort_retained)) <span class="sc">|&gt;</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">pct_retained =</span> cohort_retained <span class="sc">/</span> cohort_size) <span class="sc">|&gt;</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(cohort, period, cohort_size, cohort_retained,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>           pct_retained) <span class="sc">|&gt;</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(cohort, period)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As can be seen from the following output, we get the same results using <code>get_pct_retained()</code> as we got above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_pct_retained</span>(first_centuries, census_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_64807iowzk8dec200puq(i, j, css_id) {
          var table = document.getElementById("tinytable_64807iowzk8dec200puq");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_64807iowzk8dec200puq');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_64807iowzk8dec200puq(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_64807iowzk8dec200puq");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 10, j: 2 }, { i: 10, j: 0 }, { i: 10, j: 1 }, { i: 10, j: 3 },  ], css_id: 'tinytable_css_xwcqxfibg9tkw81sbs4x',}, 
          { positions: [ { i: 10, j: 4 },  ], css_id: 'tinytable_css_t7697plhaqxdcxjtq5tk',}, 
          { positions: [ { i: 2, j: 0 }, { i: 4, j: 0 }, { i: 1, j: 0 }, { i: 6, j: 0 }, { i: 8, j: 0 }, { i: 5, j: 0 }, { i: 1, j: 2 }, { i: 3, j: 0 }, { i: 1, j: 1 }, { i: 2, j: 1 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 5, j: 1 }, { i: 6, j: 1 }, { i: 7, j: 1 }, { i: 8, j: 1 }, { i: 7, j: 0 }, { i: 1, j: 3 }, { i: 9, j: 0 }, { i: 3, j: 3 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 4, j: 2 }, { i: 5, j: 2 }, { i: 6, j: 2 }, { i: 7, j: 2 }, { i: 8, j: 2 }, { i: 9, j: 2 }, { i: 7, j: 3 }, { i: 9, j: 1 }, { i: 5, j: 3 }, { i: 2, j: 3 }, { i: 4, j: 3 }, { i: 9, j: 3 }, { i: 6, j: 3 }, { i: 8, j: 3 },  ], css_id: 'tinytable_css_p0ljwh2nwymgitc48a97',}, 
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 2 }, { i: 0, j: 3 }, { i: 0, j: 1 },  ], css_id: 'tinytable_css_l5ecztsn955kg6ehtvhv',}, 
          { positions: [ { i: 0, j: 4 },  ], css_id: 'tinytable_css_erm2t4souxmdm1swka6t',}, 
          { positions: [ { i: 1, j: 4 }, { i: 2, j: 4 }, { i: 3, j: 4 }, { i: 4, j: 4 }, { i: 5, j: 4 }, { i: 6, j: 4 }, { i: 7, j: 4 }, { i: 8, j: 4 }, { i: 9, j: 4 },  ], css_id: 'tinytable_css_2khl4vqlhkydmg2jovp4',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_64807iowzk8dec200puq(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_xwcqxfibg9tkw81sbs4x, .table th.tinytable_css_xwcqxfibg9tkw81sbs4x { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_t7697plhaqxdcxjtq5tk, .table th.tinytable_css_t7697plhaqxdcxjtq5tk { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_p0ljwh2nwymgitc48a97, .table th.tinytable_css_p0ljwh2nwymgitc48a97 { padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_l5ecztsn955kg6ehtvhv, .table th.tinytable_css_l5ecztsn955kg6ehtvhv { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_erm2t4souxmdm1swka6t, .table th.tinytable_css_erm2t4souxmdm1swka6t { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_2khl4vqlhkydmg2jovp4, .table th.tinytable_css_2khl4vqlhkydmg2jovp4 { padding-bottom: 0em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_64807iowzk8dec200puq" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">cohort</th>
                <th scope="col">period</th>
                <th scope="col">cohort_size</th>
                <th scope="col">cohort_retained</th>
                <th scope="col">pct_retained</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>18</td>
                  <td>0</td>
                  <td>368</td>
                  <td>368</td>
                  <td>1.0000000</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>1</td>
                  <td>368</td>
                  <td>360</td>
                  <td>0.9782609</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>2</td>
                  <td>368</td>
                  <td>242</td>
                  <td>0.6576087</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>3</td>
                  <td>368</td>
                  <td>233</td>
                  <td>0.6331522</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>4</td>
                  <td>368</td>
                  <td>149</td>
                  <td>0.4048913</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>5</td>
                  <td>368</td>
                  <td>144</td>
                  <td>0.3913043</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>6</td>
                  <td>368</td>
                  <td> 99</td>
                  <td>0.2690217</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>7</td>
                  <td>368</td>
                  <td>101</td>
                  <td>0.2744565</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>8</td>
                  <td>368</td>
                  <td> 73</td>
                  <td>0.1983696</td>
                </tr>
                <tr>
                  <td>18</td>
                  <td>9</td>
                  <td>368</td>
                  <td> 70</td>
                  <td>0.1902174</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>The benefit of using a function like this is that it makes it easy to do the analysis using different cohorts. Here I re-run the analysis using cohorts formed on <code>gender</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>genders <span class="ot">&lt;-</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  legislators <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(id_bioguide, gender) <span class="sc">|&gt;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">cohort =</span> gender)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">get_pct_retained</span>(genders, census_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_3gc7tm5qnl6z5b5lclgd(i, j, css_id) {
          var table = document.getElementById("tinytable_3gc7tm5qnl6z5b5lclgd");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_3gc7tm5qnl6z5b5lclgd');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_3gc7tm5qnl6z5b5lclgd(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_3gc7tm5qnl6z5b5lclgd");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 10, j: 2 }, { i: 10, j: 0 }, { i: 10, j: 1 }, { i: 10, j: 3 },  ], css_id: 'tinytable_css_xkj2qie1q1xa2w8b3q3k',}, 
          { positions: [ { i: 0, j: 4 },  ], css_id: 'tinytable_css_ool93ww0l9nupiig1a1m',}, 
          { positions: [ { i: 10, j: 4 },  ], css_id: 'tinytable_css_g8qamflcpk8yidrrbu94',}, 
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 2 }, { i: 0, j: 3 }, { i: 0, j: 1 },  ], css_id: 'tinytable_css_7cqev1pwqzlw7mbv5qyx',}, 
          { positions: [ { i: 1, j: 4 }, { i: 2, j: 4 }, { i: 3, j: 4 }, { i: 4, j: 4 }, { i: 5, j: 4 }, { i: 6, j: 4 }, { i: 7, j: 4 }, { i: 8, j: 4 }, { i: 9, j: 4 },  ], css_id: 'tinytable_css_6wp2bbizy000homw3g1n',}, 
          { positions: [ { i: 2, j: 0 }, { i: 4, j: 0 }, { i: 1, j: 0 }, { i: 6, j: 0 }, { i: 8, j: 0 }, { i: 5, j: 0 }, { i: 1, j: 2 }, { i: 3, j: 0 }, { i: 1, j: 1 }, { i: 2, j: 1 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 5, j: 1 }, { i: 6, j: 1 }, { i: 7, j: 1 }, { i: 8, j: 1 }, { i: 7, j: 0 }, { i: 1, j: 3 }, { i: 9, j: 0 }, { i: 3, j: 3 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 4, j: 2 }, { i: 5, j: 2 }, { i: 6, j: 2 }, { i: 7, j: 2 }, { i: 8, j: 2 }, { i: 9, j: 2 }, { i: 7, j: 3 }, { i: 9, j: 1 }, { i: 5, j: 3 }, { i: 2, j: 3 }, { i: 4, j: 3 }, { i: 9, j: 3 }, { i: 6, j: 3 }, { i: 8, j: 3 },  ], css_id: 'tinytable_css_4vri58kgdnm0lrc9c1qo',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_3gc7tm5qnl6z5b5lclgd(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_xkj2qie1q1xa2w8b3q3k, .table th.tinytable_css_xkj2qie1q1xa2w8b3q3k { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_ool93ww0l9nupiig1a1m, .table th.tinytable_css_ool93ww0l9nupiig1a1m { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_g8qamflcpk8yidrrbu94, .table th.tinytable_css_g8qamflcpk8yidrrbu94 { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_7cqev1pwqzlw7mbv5qyx, .table th.tinytable_css_7cqev1pwqzlw7mbv5qyx { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_6wp2bbizy000homw3g1n, .table th.tinytable_css_6wp2bbizy000homw3g1n { padding-bottom: 0em; }
      .table td.tinytable_css_4vri58kgdnm0lrc9c1qo, .table th.tinytable_css_4vri58kgdnm0lrc9c1qo { padding-right: 0.1em; padding-bottom: 0em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_3gc7tm5qnl6z5b5lclgd" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">cohort</th>
                <th scope="col">period</th>
                <th scope="col">cohort_size</th>
                <th scope="col">cohort_retained</th>
                <th scope="col">pct_retained</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>F</td>
                  <td>0</td>
                  <td>366</td>
                  <td>366</td>
                  <td>1.0000000</td>
                </tr>
                <tr>
                  <td>F</td>
                  <td>1</td>
                  <td>366</td>
                  <td>349</td>
                  <td>0.9535519</td>
                </tr>
                <tr>
                  <td>F</td>
                  <td>2</td>
                  <td>366</td>
                  <td>261</td>
                  <td>0.7131148</td>
                </tr>
                <tr>
                  <td>F</td>
                  <td>3</td>
                  <td>366</td>
                  <td>256</td>
                  <td>0.6994536</td>
                </tr>
                <tr>
                  <td>F</td>
                  <td>4</td>
                  <td>366</td>
                  <td>223</td>
                  <td>0.6092896</td>
                </tr>
                <tr>
                  <td>F</td>
                  <td>5</td>
                  <td>366</td>
                  <td>222</td>
                  <td>0.6065574</td>
                </tr>
                <tr>
                  <td>F</td>
                  <td>6</td>
                  <td>366</td>
                  <td>178</td>
                  <td>0.4863388</td>
                </tr>
                <tr>
                  <td>F</td>
                  <td>7</td>
                  <td>366</td>
                  <td>174</td>
                  <td>0.4754098</td>
                </tr>
                <tr>
                  <td>F</td>
                  <td>8</td>
                  <td>366</td>
                  <td>143</td>
                  <td>0.3907104</td>
                </tr>
                <tr>
                  <td>F</td>
                  <td>9</td>
                  <td>366</td>
                  <td>139</td>
                  <td>0.3797814</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>It is relatively straightforward to apply <code>get_pct_retained()</code> to replicate the “retention for legislators who were in office in the year 2000” analysis <span class="citation" data-cites="tanimura2021sql">(<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">Tanimura 2021, 151–53</a>)</span>. Defining the cohorts is fairly straightforward:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>test_year <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>year_start <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="fu">str_c</span>(test_year, <span class="st">"-01-01"</span>))</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>year_end <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="fu">str_c</span>(test_year, <span class="st">"-12-31"</span>))</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>legislators_2000 <span class="ot">&lt;-</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  legislators_terms <span class="sc">|&gt;</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term_start <span class="sc">&lt;=</span> year_start, term_end <span class="sc">&gt;=</span> year_end) <span class="sc">|&gt;</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(id_bioguide, term_type) <span class="sc">|&gt;</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">cohort =</span> term_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The main tweak is to the calculation of the census data, as <code>"2000-01-01"</code> is used in place of <code>first_term</code> and we need to focus on dates in or after 2000 (this is achieved using <code>filter(period &gt;= 0)</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>census_data_2000 <span class="ot">&lt;-</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  legislators_terms <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_bioguide, term_type, term_start, term_end) <span class="sc">|&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(year_ends, </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">join_by</span>(</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>               <span class="fu">between</span>(y<span class="sc">$</span>date, x<span class="sc">$</span>term_start, x<span class="sc">$</span>term_end))) <span class="sc">|&gt;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">coalesce</span>(<span class="fu">year</span>(<span class="fu">age</span>(date, year_start)), <span class="dv">0</span>)) <span class="sc">|&gt;</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(period <span class="sc">&gt;=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now I just need to call the same function. Note that I sort the data to match the output in the book <span class="citation" data-cites="tanimura2021sql">(<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">Tanimura 2021, 152</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_pct_retained</span>(legislators_2000, census_data_2000) <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(period, cohort)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_syo4wwjoaje1h6u986sv(i, j, css_id) {
          var table = document.getElementById("tinytable_syo4wwjoaje1h6u986sv");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_syo4wwjoaje1h6u986sv');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_syo4wwjoaje1h6u986sv(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_syo4wwjoaje1h6u986sv");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 10, j: 4 },  ], css_id: 'tinytable_css_t9zt1cakiqudu970jizg',}, 
          { positions: [ { i: 1, j: 4 }, { i: 2, j: 4 }, { i: 3, j: 4 }, { i: 4, j: 4 }, { i: 5, j: 4 }, { i: 6, j: 4 }, { i: 7, j: 4 }, { i: 8, j: 4 }, { i: 9, j: 4 },  ], css_id: 'tinytable_css_rfrzhb5qzs3gfd7u66g8',}, 
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 2 }, { i: 0, j: 3 }, { i: 0, j: 1 },  ], css_id: 'tinytable_css_nvs74rys77b7aqsni4od',}, 
          { positions: [ { i: 0, j: 4 },  ], css_id: 'tinytable_css_ip4b8kdwvqzdbtja26dr',}, 
          { positions: [ { i: 10, j: 2 }, { i: 10, j: 0 }, { i: 10, j: 1 }, { i: 10, j: 3 },  ], css_id: 'tinytable_css_a10qohde4ad06um1jcn9',}, 
          { positions: [ { i: 2, j: 0 }, { i: 4, j: 0 }, { i: 1, j: 0 }, { i: 6, j: 0 }, { i: 8, j: 0 }, { i: 5, j: 0 }, { i: 1, j: 2 }, { i: 3, j: 0 }, { i: 1, j: 1 }, { i: 2, j: 1 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 5, j: 1 }, { i: 6, j: 1 }, { i: 7, j: 1 }, { i: 8, j: 1 }, { i: 7, j: 0 }, { i: 1, j: 3 }, { i: 9, j: 0 }, { i: 3, j: 3 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 4, j: 2 }, { i: 5, j: 2 }, { i: 6, j: 2 }, { i: 7, j: 2 }, { i: 8, j: 2 }, { i: 9, j: 2 }, { i: 7, j: 3 }, { i: 9, j: 1 }, { i: 5, j: 3 }, { i: 2, j: 3 }, { i: 4, j: 3 }, { i: 9, j: 3 }, { i: 6, j: 3 }, { i: 8, j: 3 },  ], css_id: 'tinytable_css_0tlh59a0tzwjxpvt806y',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_syo4wwjoaje1h6u986sv(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_t9zt1cakiqudu970jizg, .table th.tinytable_css_t9zt1cakiqudu970jizg { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_rfrzhb5qzs3gfd7u66g8, .table th.tinytable_css_rfrzhb5qzs3gfd7u66g8 { padding-bottom: 0em; }
      .table td.tinytable_css_nvs74rys77b7aqsni4od, .table th.tinytable_css_nvs74rys77b7aqsni4od { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_ip4b8kdwvqzdbtja26dr, .table th.tinytable_css_ip4b8kdwvqzdbtja26dr { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_a10qohde4ad06um1jcn9, .table th.tinytable_css_a10qohde4ad06um1jcn9 { border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_0tlh59a0tzwjxpvt806y, .table th.tinytable_css_0tlh59a0tzwjxpvt806y { padding-right: 0.1em; padding-bottom: 0em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_syo4wwjoaje1h6u986sv" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">cohort</th>
                <th scope="col">period</th>
                <th scope="col">cohort_size</th>
                <th scope="col">cohort_retained</th>
                <th scope="col">pct_retained</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>rep</td>
                  <td>0</td>
                  <td>439</td>
                  <td>439</td>
                  <td>1.0000000</td>
                </tr>
                <tr>
                  <td>sen</td>
                  <td>0</td>
                  <td>100</td>
                  <td>100</td>
                  <td>1.0000000</td>
                </tr>
                <tr>
                  <td>rep</td>
                  <td>1</td>
                  <td>439</td>
                  <td>392</td>
                  <td>0.8929385</td>
                </tr>
                <tr>
                  <td>sen</td>
                  <td>1</td>
                  <td>100</td>
                  <td> 88</td>
                  <td>0.8800000</td>
                </tr>
                <tr>
                  <td>rep</td>
                  <td>2</td>
                  <td>439</td>
                  <td>389</td>
                  <td>0.8861048</td>
                </tr>
                <tr>
                  <td>sen</td>
                  <td>2</td>
                  <td>100</td>
                  <td> 85</td>
                  <td>0.8500000</td>
                </tr>
                <tr>
                  <td>rep</td>
                  <td>3</td>
                  <td>439</td>
                  <td>340</td>
                  <td>0.7744875</td>
                </tr>
                <tr>
                  <td>sen</td>
                  <td>3</td>
                  <td>100</td>
                  <td> 79</td>
                  <td>0.7900000</td>
                </tr>
                <tr>
                  <td>rep</td>
                  <td>4</td>
                  <td>439</td>
                  <td>338</td>
                  <td>0.7699317</td>
                </tr>
                <tr>
                  <td>sen</td>
                  <td>4</td>
                  <td>100</td>
                  <td> 79</td>
                  <td>0.7900000</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>jqa_census_data <span class="ot">&lt;-</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  census_data <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id_bioguide <span class="sc">==</span> <span class="st">"A000041"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_bioguide, term_type, term_start, term_end,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>         date, period)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div id="tbl-jqa" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-jqa-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5.11: Census data for John Quincy Adams
</figcaption>
<div aria-describedby="tbl-jqa-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_dwzti39hktf0pbkxr82g(i, j, css_id) {
          var table = document.getElementById("tinytable_dwzti39hktf0pbkxr82g");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_dwzti39hktf0pbkxr82g');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_dwzti39hktf0pbkxr82g(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_dwzti39hktf0pbkxr82g");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 24, j: 3 }, { i: 24, j: 0 }, { i: 24, j: 2 }, { i: 24, j: 1 }, { i: 24, j: 4 },  ], css_id: 'tinytable_css_wa4ja83zw4bcq70duov9',}, 
          { positions: [ { i: 1, j: 0 }, { i: 2, j: 0 }, { i: 3, j: 0 }, { i: 4, j: 0 }, { i: 5, j: 0 }, { i: 6, j: 0 }, { i: 11, j: 0 }, { i: 8, j: 0 }, { i: 13, j: 0 }, { i: 14, j: 0 }, { i: 15, j: 0 }, { i: 16, j: 0 }, { i: 17, j: 0 }, { i: 18, j: 0 }, { i: 19, j: 0 }, { i: 7, j: 0 }, { i: 21, j: 0 }, { i: 9, j: 0 }, { i: 23, j: 0 }, { i: 14, j: 2 }, { i: 12, j: 0 }, { i: 1, j: 1 }, { i: 2, j: 1 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 5, j: 1 }, { i: 6, j: 1 }, { i: 7, j: 1 }, { i: 8, j: 1 }, { i: 9, j: 1 }, { i: 22, j: 0 }, { i: 11, j: 1 }, { i: 12, j: 1 }, { i: 13, j: 1 }, { i: 14, j: 1 }, { i: 15, j: 1 }, { i: 16, j: 1 }, { i: 17, j: 1 }, { i: 18, j: 1 }, { i: 19, j: 1 }, { i: 20, j: 1 }, { i: 21, j: 1 }, { i: 22, j: 1 }, { i: 23, j: 1 }, { i: 14, j: 3 }, { i: 10, j: 0 }, { i: 1, j: 2 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 4, j: 2 }, { i: 5, j: 2 }, { i: 6, j: 2 }, { i: 7, j: 2 }, { i: 8, j: 2 }, { i: 9, j: 2 }, { i: 20, j: 0 }, { i: 11, j: 2 }, { i: 12, j: 2 }, { i: 13, j: 2 }, { i: 4, j: 4 }, { i: 15, j: 2 }, { i: 16, j: 2 }, { i: 17, j: 2 }, { i: 18, j: 2 }, { i: 19, j: 2 }, { i: 20, j: 2 }, { i: 21, j: 2 }, { i: 22, j: 2 }, { i: 23, j: 2 }, { i: 14, j: 4 }, { i: 10, j: 1 }, { i: 1, j: 3 }, { i: 2, j: 3 }, { i: 3, j: 3 }, { i: 4, j: 3 }, { i: 5, j: 3 }, { i: 6, j: 3 }, { i: 7, j: 3 }, { i: 8, j: 3 }, { i: 9, j: 3 }, { i: 10, j: 3 }, { i: 11, j: 3 }, { i: 12, j: 3 }, { i: 13, j: 3 }, { i: 2, j: 4 }, { i: 15, j: 3 }, { i: 16, j: 3 }, { i: 17, j: 3 }, { i: 18, j: 3 }, { i: 19, j: 3 }, { i: 20, j: 3 }, { i: 21, j: 3 }, { i: 22, j: 3 }, { i: 23, j: 3 }, { i: 12, j: 4 }, { i: 10, j: 2 }, { i: 1, j: 4 }, { i: 15, j: 4 }, { i: 3, j: 4 }, { i: 17, j: 4 }, { i: 5, j: 4 }, { i: 6, j: 4 }, { i: 7, j: 4 }, { i: 8, j: 4 }, { i: 9, j: 4 }, { i: 10, j: 4 }, { i: 11, j: 4 }, { i: 16, j: 4 }, { i: 13, j: 4 }, { i: 18, j: 4 }, { i: 19, j: 4 }, { i: 20, j: 4 }, { i: 21, j: 4 }, { i: 22, j: 4 }, { i: 23, j: 4 },  ], css_id: 'tinytable_css_uzuyrdffp2zcdcnzsmnq',}, 
          { positions: [ { i: 1, j: 5 }, { i: 2, j: 5 }, { i: 3, j: 5 }, { i: 4, j: 5 }, { i: 5, j: 5 }, { i: 6, j: 5 }, { i: 7, j: 5 }, { i: 8, j: 5 }, { i: 9, j: 5 }, { i: 10, j: 5 }, { i: 11, j: 5 }, { i: 12, j: 5 }, { i: 13, j: 5 }, { i: 14, j: 5 }, { i: 15, j: 5 }, { i: 16, j: 5 }, { i: 17, j: 5 }, { i: 18, j: 5 }, { i: 19, j: 5 }, { i: 20, j: 5 }, { i: 21, j: 5 }, { i: 22, j: 5 }, { i: 23, j: 5 },  ], css_id: 'tinytable_css_tvcdou4tm7k0zg83iji8',}, 
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 3 }, { i: 0, j: 2 }, { i: 0, j: 4 }, { i: 0, j: 1 },  ], css_id: 'tinytable_css_sz5yyb4kh2rf8dq5mvb3',}, 
          { positions: [ { i: 0, j: 5 },  ], css_id: 'tinytable_css_abc5jdqmmmqimkt1zvaw',}, 
          { positions: [ { i: 24, j: 5 },  ], css_id: 'tinytable_css_6bn7chexurvuuy1pp664',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_dwzti39hktf0pbkxr82g(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_wa4ja83zw4bcq70duov9, .table th.tinytable_css_wa4ja83zw4bcq70duov9 { font-size: 0.8em; border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; }
      .table td.tinytable_css_uzuyrdffp2zcdcnzsmnq, .table th.tinytable_css_uzuyrdffp2zcdcnzsmnq { font-size: 0.8em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_tvcdou4tm7k0zg83iji8, .table th.tinytable_css_tvcdou4tm7k0zg83iji8 { font-size: 0.8em; padding-bottom: 0em; }
      .table td.tinytable_css_sz5yyb4kh2rf8dq5mvb3, .table th.tinytable_css_sz5yyb4kh2rf8dq5mvb3 { font-size: 0.8em; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-right: 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_abc5jdqmmmqimkt1zvaw, .table th.tinytable_css_abc5jdqmmmqimkt1zvaw { font-size: 0.8em; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; border-bottom: solid #d3d8dc 0.1em; padding-bottom: 0em; }
      .table td.tinytable_css_6bn7chexurvuuy1pp664, .table th.tinytable_css_6bn7chexurvuuy1pp664 { font-size: 0.8em; border-bottom: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.1em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_dwzti39hktf0pbkxr82g" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col">id_bioguide</th>
                <th scope="col">term_type</th>
                <th scope="col">term_start</th>
                <th scope="col">term_end</th>
                <th scope="col">date</th>
                <th scope="col">period</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>A000041</td>
                  <td>sen</td>
                  <td>1803-10-17</td>
                  <td>1809-03-03</td>
                  <td>1803-12-31</td>
                  <td> 0</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>sen</td>
                  <td>1803-10-17</td>
                  <td>1809-03-03</td>
                  <td>1804-12-31</td>
                  <td> 1</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>sen</td>
                  <td>1803-10-17</td>
                  <td>1809-03-03</td>
                  <td>1805-12-31</td>
                  <td> 2</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>sen</td>
                  <td>1803-10-17</td>
                  <td>1809-03-03</td>
                  <td>1806-12-31</td>
                  <td> 3</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>sen</td>
                  <td>1803-10-17</td>
                  <td>1809-03-03</td>
                  <td>1807-12-31</td>
                  <td> 4</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>sen</td>
                  <td>1803-10-17</td>
                  <td>1809-03-03</td>
                  <td>1808-12-31</td>
                  <td> 5</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1831-12-05</td>
                  <td>1833-03-03</td>
                  <td>1831-12-31</td>
                  <td>28</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1831-12-05</td>
                  <td>1833-03-03</td>
                  <td>1832-12-31</td>
                  <td>29</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1833-12-02</td>
                  <td>1835-03-03</td>
                  <td>1833-12-31</td>
                  <td>30</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1833-12-02</td>
                  <td>1835-03-03</td>
                  <td>1834-12-31</td>
                  <td>31</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1835-12-07</td>
                  <td>1837-03-03</td>
                  <td>1835-12-31</td>
                  <td>32</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1835-12-07</td>
                  <td>1837-03-03</td>
                  <td>1836-12-31</td>
                  <td>33</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1837-09-04</td>
                  <td>1839-03-03</td>
                  <td>1837-12-31</td>
                  <td>34</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1837-09-04</td>
                  <td>1839-03-03</td>
                  <td>1838-12-31</td>
                  <td>35</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1839-12-02</td>
                  <td>1841-03-03</td>
                  <td>1839-12-31</td>
                  <td>36</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1839-12-02</td>
                  <td>1841-03-03</td>
                  <td>1840-12-31</td>
                  <td>37</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1841-05-31</td>
                  <td>1843-03-03</td>
                  <td>1841-12-31</td>
                  <td>38</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1841-05-31</td>
                  <td>1843-03-03</td>
                  <td>1842-12-31</td>
                  <td>39</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1843-12-04</td>
                  <td>1845-03-03</td>
                  <td>1843-12-31</td>
                  <td>40</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1843-12-04</td>
                  <td>1845-03-03</td>
                  <td>1844-12-31</td>
                  <td>41</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1845-12-01</td>
                  <td>1847-03-03</td>
                  <td>1845-12-31</td>
                  <td>42</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1845-12-01</td>
                  <td>1847-03-03</td>
                  <td>1846-12-31</td>
                  <td>43</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1847-12-06</td>
                  <td>1849-03-03</td>
                  <td>1847-12-31</td>
                  <td>44</td>
                </tr>
                <tr>
                  <td>A000041</td>
                  <td>rep</td>
                  <td>1847-12-06</td>
                  <td>1849-03-03</td>
                  <td>1848-12-31</td>
                  <td>45</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-singer2003longitudinal" class="csl-entry" role="listitem">
Singer, Judith D., and John B. Willett. 2003. <em>Applied Longitudinal Data Analysis: Modeling Change and Event Occurrence</em>. Oxford University PressNew York. <a href="https://doi.org/10.1093/acprof:oso/9780195152968.001.0001">https://doi.org/10.1093/acprof:oso/9780195152968.001.0001</a>.
</div>
<div id="ref-tanimura2021sql" class="csl-entry" role="listitem">
Tanimura, C. 2021. <em>SQL for Data Analysis</em>. O’Reilly Media. <a href="https://books.google.com.au/books?id=ojhCEAAAQBAJ">https://books.google.com.au/books?id=ojhCEAAAQBAJ</a>.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>By “advanced” I mean relative to the standards implicitly expected of readers of <span class="citation" data-cites="tanimura2021sql">Tanimura (<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">2021</a>)</span>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Most queries uses what I call a census-date approach that I discuss in <a href="#sec-census-date" class="quarto-xref"><span>Section 5.1.3</span></a>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>The choice of <code>term_start</code> rather than <code>term_end</code> is an odd one that is justified by the notion that “we don’t need to know the specific dates of each term” because of a focus on “the share of legislators who survived in office for a decade or more after their first term started” <span class="citation" data-cites="tanimura2021sql">(<a href="references.html#ref-tanimura2021sql" role="doc-biblioref">Tanimura 2021, 154</a>)</span>. Of course, a two-term senator will serve for 12 years, but the tenure calculated in this way would be six years rather than 12, which would seem to be a material error.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Things might be different for people born on 29 February.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>The <code>legislators_terms</code> data set ends before Pelosi’s term ending in January 2021. From that data set, it is not clear that Pelosi was elected to additional terms beginning in 2021 and 2023.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>According to <a href="https://en.wikipedia.org/wiki/Nancy_Pelosi#Electoral_history">Wikipedia</a>, the shifts from one district to another were due to redistricting, or the redrawing of electoral boundaries as population numbers changed.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>According to <a href="https://en.wikipedia.org/wiki/John_Randolph_of_Roanoke">Wikipedia</a>, Randolph did not present his credentials and soon resigned for health reasons.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>It might be viewed as the concatenation of multiple cohort analyses, one for each period studied.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./dbplyr.html" class="pagination-link" aria-label="Cohorts using `dbplyr`">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Cohorts using <code>dbplyr</code></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./revised.html" class="pagination-link" aria-label="Cohorts: Revised">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Cohorts: Revised</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>